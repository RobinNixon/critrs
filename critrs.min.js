const VERSION="0.9b01",DIDCOPY="The following code has been copied to the clipboard. Paste it into the 'presets.js' file to save the current settings as a new preset.\n\n",NOTCOPY=" Could not copy the below to the clipboard, so manually type it into the 'presets.js' file to save the current settings as a new preset.\n\n",MUTATEDELAY=15,FPSBUFSIZE=200,RLE0="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@#;",RLE1=" :£$%^&*()-_+={}[]~<>,.?/|¬";MAXWIDTH=2600,MAXHEIGHT=700;let TGUIDE,DIDPRESET=GUIDE=DISPLAY=!0,MUTATE=SHOWN=LIMIT=LCLICK=RCLICK=STEP=SHIFT=EDITMODE=MONO=TRACK=HARDB=VARYLIFE=MULTIPASS=ZOOMED=STEPFLAG=!1,MOUSEX=MOUSEY=EDITX=EDITY=PAGEX=PAGEY=PRESET=MUTATECT=OFFSETX=OFFSETY=TOP=ROTIMEOUT=GUIDECT=LEFT=0,CRITRTYPE=0,GUIDERATE=10,RSLTN=1,BWIDTH=Math.min(MAXWIDTH,window.innerWidth-32),BHEIGHT=Math.min(MAXHEIGHT,window.innerHeight-12),WORLD=createArray(MAXWIDTH,MAXHEIGHT),WORLD2=createArray(MAXWIDTH,MAXHEIGHT),ZOOMCT=ZOOMLEV=100,MODEX=BWIDTH/ZOOMCT,MODEY=BHEIGHT/ZOOMCT,WIDTH=BWIDTH,HEIGHT=BHEIGHT,SCALEX=BWIDTH/WIDTH,SCALEY=BHEIGHT/HEIGHT,LEN1=LEN2=2,RULES=createArray(9,9,4),OLDFPS=FPS=30,FPSA=Array(FPSBUFSIZE).fill(FPS),MUTATED=new Object,MT=MUTATEDELAY+1,TIME=(new Date).getTime(),LENX=Math.floor(LEN1/2),LENY=Math.floor(LEN2/2),LENX1=LIMIT?LENX:0,LENY1=LIMIT?LENY:0,VLIFEB=[0,0,1,0,0,0,0,0],VLIFED=[1,1,0,0,1,1,1,1],CONTEXT=canvas.getContext("2d",{alpha:!1}),CANV=canvas;function init(){setupCanvas(),clearWorld(),setRes(4),newPreset(),setTimeout(mainLoop,0)}function mainLoop(){let t=0,e=0;const n=(new Date).getTime(),a=1e3/(n-TIME)|0;for(STEPFLAG||EDITMODE?drawWorld():(updateWorld(),STEPFLAG=STEP,drawWorld()),EDITMODE&&editCursor(),(LCLICK||RCLICK)&&(WORLD[Math.floor(MOUSEX+LEFT)][Math.floor(MOUSEY+TOP)]=LCLICK?1:0,ifStep(0)),MUTATE&&function(){let t,e,n,a,i;if(STEPFLAG)return;if(MUTATECT++<(FPS+1)*MUTATEDELAY)return;MUTATECT=0,MT=MUTATEDELAY+1,DIDPRESET=!1;for(;;)if(t=intRand(LEN1),e=intRand(LEN2),n=LIMIT?intRand(Math.min(LEN2,2)):intRand(LEN2),a=LIMIT?intRand(Math.min(LEN1,2)):intRand(LEN1),i=2*intRand(2),RULES[t][e][i]!=n||RULES[t][e][i+1]!=a){MUTATED.f=!0,MUTATED.x=t,MUTATED.y=e,MUTATED.p=n,MUTATED.q=a,MUTATED.r=RULES[t][e][2*i],MUTATED.s=RULES[t][e][2*i+1],setRule(t,e,n,a,i,1);break}}(),DISPLAY&&function(){let t=1,e="";if(SHOWN)return updateControls();if(e+="<table style='border:1px solid #00f; margin:5px; background:#004; opacity:80%'><tr><td><table style='border:none' width=320>",e+="<tr><th colspan=2 style='height:20px; background:#008; color:#8f8;border:1px solid #008; font-size:16px; text-align:center'><b>CRITRS v"+VERSION+" &copy; 2021 by <a href=http://robinnixon.com>Robin Nixon</a></b>&nbsp;</span></th></tr><tr><th colspan=2></th></tr>",e+="<tr><td width=50%>Zoom Level</td><td align=right data-title='If you are not sure how far in or out your are zoomed, ensure the guide window is on and refer to it'><span id=i0>&nbsp;</span></td></tr>",e+="<tr><td>Current Preset</td><td align=right data-title='These presets are in the presets.js file - you can change them or add your own if you download this program'><span id=i1>&nbsp;</span></td></tr>",e+="<tr><td>Frame Rate</td><td align=right data-title='If the frame rate is slow try decreasing resolution, zooming in, or decreasing particles'><span id=i3>&nbsp;</span></td></tr>",1==CRITRTYPE){for(e+="</tr><tr><th colspan=2></th></tr>",e+="<tr><td style='color:#99f'><i>Original Game of Life Rules:</i></td><td align=right style='color:#99f'><i><span style='color:#9f9'>C = 3</span> &nbsp;/&nbsp; <span style='color:#f99'>R = 1, 4, 5, 6, 7, 8</span></i></th></tr>",e+="<tr><td>Create new particle if any of these numbers of neighbors:</td><td align=right><span style='padding-right:3px; color:#9f9'><div class=checknum>1</div><div class=checknum>2</div><div class=checknum>3</div><div class=checknum>4</div><div class=checknum>5</div><div class=checknum>6</div><div class=checknum>7</div><div class=checknum>8</div></span><br>";t<9;)e+="<input type=checkbox "+(VLIFEB[t-1]?"checked ":"")+"onclick='VLIFEB["+(t++-1)+"] ^= 1; SHOWN = false'>";for(e+="</span></td></tr>",e+="<tr><td>Remove particle if any of these numbers of neighbors:</td><td align=right><span style='padding-right:3px; color:#f99'><div class=checknum>1</div><div class=checknum>2</div><div class=checknum>3</div><div class=checknum>4</div><div class=checknum>5</div><div class=checknum>6</div><div class=checknum>7</div><div class=checknum>8</div></span><br>",t=1;t<9;)e+="<input type=checkbox "+(VLIFED[t-1]?"checked ":"")+"onclick='VLIFED ["+(t++-1)+"] ^= 1; SHOWN = false'>";e+="</span></td></tr>",e+="</tr><tr><th colspan=2></th></tr>",e+="<tr><td>Change Resolution &nbsp;<span class=keys><u>[</u>&thinsp; &hellip; &thinsp;<u>]</u></span></td><td data-title='Changing to a lower resolution (to the right) substantially increases the animation frame rate, while higher resolutions (to the left) offer much more detail, at the expense of speed' align=right><input oninput='setRes(parseInt(this.value))' type=range min=1 max=9 value="+RSLTN+"></td></tr>"}e+="</tr><tr><th colspan=2></th></tr>",e+="<tr ><td><u>G</u>uide Window</td><td data-title='Hides &amp; displays the bottom-left window - when the frame rate is slow, hiding the guide can improve animation speed' align=right><label class=switch><input onclick='setGuide()' type=checkbox "+(GUIDE?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>T</u>oggle Color / Monochrome</td><td data-title='Choose between colored or monochrome particles' align=right><label class=switch><input onclick='monoColor()' type=checkbox "+(MONO?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>P</u>ause (then <u>S</u> to Step)</td><td data-title='Select Pause then use the S key to step through animation frame by frame' align=right><label class=switch><input onclick='setStep()' type=checkbox "+(STEP?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><th colspan=2></th></tr>",0==CRITRTYPE?(e+="<tr><td>Allow <u>M</u>utation</td><td data-title='Mutation causes one random change of a rule in a rule set every 15 seconds' align=right><label class=switch><input onclick='setMutate()' type=checkbox "+(MUTATE?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>U</u>se a 2&times;2 Matrix</td><td data-title='Applying rules of larger matrixes to just a 2x2 section increases speed and perceived order' align=right><label class=switch><input onclick='setLimit()' type=checkbox "+(LIMIT?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>H</u>ard Borders</td><td data-title='By default the world is wrap-around, but you can see some very interesting effects with a hard border, such as sand and gravity-like effects - when enabled, try adding more particles using filled rectangles' align=right><label class=switch><input onclick='setHardborder()' type=checkbox "+(HARDB?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>E</u>nable Multiple Passes</td><td data-title='Sometimes strange glitch effects occur when one application of rules clashes with the subsequent rule set application - by using multiple, staggered passes, this effect is diminished' align=right><label class=switch><input onclick='setMultipass()' type=checkbox "+(MULTIPASS?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td>Track <u>I</u>nvisible Particles</td><td data-title='Some particles move a greater distance than the matrix dimensions each frame, and may not be seen until they collide with another - with this option you can see their trails as a series of small dots - mainly applicable to single passes' align=right><label class=switch><input onclick='trackChange()' type=checkbox "+(TRACK?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><th colspan=2></th></tr>",e+="<tr><td>Change Resolution &nbsp;<span class=keys><u>[</u>&thinsp; &hellip; &thinsp;<u>]</u></span></td><td data-title='Changing to a lower resolution (to the right) substantially increases the animation frame rate, while higher resolutions (to the left) offer much more detail, at the expense of speed' align=right><input oninput='setRes(parseInt(this.value))' type=range min=1 max=9 value="+RSLTN+"></td></tr>",e+="<tr><td>Columns: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class=keys><u>1</u> &hellip; <u>9</u></span></td><td align=right data-title='More columns brings more complexity'><input oninput='LEN1=parseInt(this.value); setRules()' type=range min=1 max=9 value="+LEN1+"></td></tr>",e+="<tr><td>Rows: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class=keys><u>Shift</u>-<u>1</u> &hellip; <u>9</u></span></td><td align=right data-title='More rows increases complexity'><input oninput='LEN2=parseInt(this.value); setRules()' type=range min=1 max=9 value="+LEN2+"></td></tr>",e+="<tr><th colspan=2></th></tr>",e+="<tr><td><span id=i2a>Next Mutation</span><td align=right data-title='When mutation is on a random rule change is automaticallyapplied every 15 seconds'><span id=i2b>&nbsp;</span></td></tr>",e+="<tr><td>Matrix Dimensions</td><td align=right data-title='The width and height of the rule matrix'><span id=i4>&nbsp;</span></td></tr>",e+="<tr><td>Number of Cells</td><td align=right data-title='The total number of cells in the rule matrix'><span id=i5>&nbsp;</span></td></tr>",e+="<tr><td>Available Rules per Cell</td><td align=right data-title='The number of different possible combinations of rules per matrix cell'><span id=i6>&nbsp;</span></td></tr>",e+="<tr><td>Possible Combinations</td><td align=right data-title='The grand total number of possible variations of rules for this matrix'><span id=i7>nbsp;<sup>&nbsp;</sup></span></td></tr>",e+="<tr><th colspan=2></th></tr>",e+="<tr><td colspan=2><button onclick='playLife()' style='width:100%'>This is CRITRS - Play The Game of Life</button></td></tr>"):1==CRITRTYPE&&(e+="</tr><tr><th colspan=2></th></tr>",e+="<tr><td colspan=2><button onclick='playCritrs()' style='width:100%'>This is The Game of Life - Play CRITRS</button></td></tr>");e+="<tr><td align=middle><button data-title='Draws a random line of particles in the current view' onclick='randomLine()' style='width:100%'>Random <u>L</u>ine</button></td>",e+=0==CRITRTYPE?"<td align=middle><button data-title='Creates a new random set of rules for this matrix configuration - Tips: Draw with the mouse or add lines &amp; rectangles for interesting results; Click or double click in the rules matrix to change rules' onclick='setRules()' style='width:100%'><u>N</u>ew Random Ruleset</button></td></tr>":"<td align=middle><button data-title='Creates a new random set of rules for the Game of Life - Tips: Draw with the mouse or add lines &amp; rectangles for interesting results - or use the checkboxes above to modify them yourself' onclick='setRules()' style='width:100%'><u>N</u>ew Random Ruleset</button></td></tr>";e+="<tr><td align=middle><button data-title='Draws a random open rectangle of particles in the current view' onclick='randomOpenRectangle()' style='width:100%'>Random <u>O</u>pen Rect.</button></td><td align=middle><button data-title='Draws a random filled rectangle of particles in the current view' onclick='randomFilledRectangle()' style='width:100%'>Random <u>F</u>illed Rect.</button></td></tr>",e+="<tr><td align=middle><button data-title='Loads the next ready-made configuration of particles and rules into the current view' onclick='newPreset()' style='width:100%'><u>A</u>pply Next Preset</button></td><td align=middle><button data-title='Removes all particles from the world' onclick='clearWorld()' style='width:100%'><u>C</u>lear All Particles</button></td></tr>",e+="<tr><td align=middle><button data-title='Fills the current view with particles spelling the word Critrs' onclick='writeCritrs()' style='width:100%'><u>W</u>rite 'Critrs'</td><td align=middle><button data-title='Copies the current rule set and particle locations into the keyboard buffer for pasting into the presets.js file - Replace the data string at the end with a pair of quotes to just save the rule set' onclick='makeCode()' style='width:100%'>Copy Preset to <u>K</u>bd.</td></tr>",e+="<tr><td align=middle><button onclick='doEditmode()' data-title='Tips: You can also enter Edit Mode by Shift-Clicking in the window; Hold down Shift while editing to pan &amp zoom; Right click erases; Esc restores previous settings' style='width:100%"+(EDITMODE?";background:#800'><i>Edit Mode - <i>Esc to Exit</i>":";background:#080'><i>Enter Edit Mode")+"</i></td><td align=middle><button data-title='Hides this display &ndash; press D to restore - Tip: Use a mouse scroll wheel or touchpad to zoom in and out, and the mouse to pan' onclick='setInfo()' style='width:100%'>Hide/Restore <u>D</u>isplay</td></tr>",e+="</table></td></tr></table>",output2.innerHTML=e,SHOWN=!0}();t<FPSBUFSIZE-1;)e+=FPSA[t],FPSA[t]=FPSA[1+t++];STEP||EDITMODE?FPSA[FPSBUFSIZE-1]=OLDFPS:FPSA[FPSBUFSIZE-1]=a,FPS=Math.floor((e+a)/FPSBUFSIZE),OLDFPS=FPS,TIME=n,setTimeout(mainLoop,0)}function updateWorld(){0==CRITRTYPE&&updateCritrs(),1==CRITRTYPE&&updateLife()}function updateLife(){let t,e,n,a,i=0;for(;i<BWIDTH;){for(t=0,WORLD2[i].fill(0);t<BHEIGHT;)n=(WORLD[o(i-1)][r(t-1)]?1:0)+(WORLD[i][r(t-1)]?1:0)+(WORLD[o(i+1)][r(t-1)]?1:0)+(WORLD[o(i-1)][t]?1:0)+(WORLD[o(i+1)][t]?1:0)+(WORLD[o(i-1)][r(t+1)]?1:0)+(WORLD[i][r(t+1)]?1:0)+(WORLD[o(i+1)][r(t+1)]?1:0),(e=WORLD[i][t])&&!VLIFED[n-1]?WORLD2[i][t]=e+.05:!e&&VLIFEB[n-1]&&(WORLD2[i][t]=1),t++;i++}function o(t){return t<0&&(t+=BWIDTH),t>=BWIDTH&&(t-=BWIDTH),t}function r(t){return t<0&&(t+=BHEIGHT),t>=BHEIGHT&&(t-=BHEIGHT),t}a=WORLD,WORLD=WORLD2,WORLD2=a}function updateCritrs(){let t,e,n,a,i,o,r,l,s,d,T,E=0,c=MULTIPASS?LEN1:1,u=MULTIPASS?LEN2:1;do{t=0;do{for(e=E;e<E+(HARDB?BWIDTH-LEN1:BWIDTH+LEN1);){for(n=t;n<t+(HARDB?BHEIGHT-LEN2:BHEIGHT+LEN2);){for(a=0;a<LEN1;){for(i=0;i<LEN2;)WORLD[(e+a)%BWIDTH][(n+i)%BHEIGHT]&&(l=(e+RULES[a][i][1]+LENX1)%BWIDTH,d=(n+RULES[a][i][0]+LENY1)%BHEIGHT,s=(e+RULES[a][i][3]+LENX1)%BWIDTH,T=(n+RULES[a][i][2]+LENY1)%BHEIGHT,(o=WORLD[l][d])&&++o,(r=WORLD[s][T])&&++r,STEPFLAG||o==r||(TRACK&&(WORLD2[l][d]=1),WORLD[l][d]=r,WORLD[s][T]=o)),i++;a++}n+=u}e+=c}++t}while(t<u);++E}while(E<c)}function drawWorld(){let t,e,n,a,i=0,o="",r=0;const l=SCALEX*RSLTN,s=SCALEY*RSLTN,d=FPS<15?Math.ceil(l/4+.5):l/4+.5,T=FPS<15?Math.ceil(s/4+.5):s/4+.5,E=FPS<15?Math.floor(l+1):l+1,c=FPS<15?Math.floor(s+1):s+1,u=.8*BHEIGHT,h=.8*BWIDTH,f=(Math.floor(u-l-2),OFFSETY,Math.floor(BWIDTH/5+s+2),OFFSETX,BWIDTH*RSLTN),p=BHEIGHT*RSLTN;for(CONTEXT.fillStyle="#102",GUIDE?(CONTEXT.fillRect(0,0,f,u*RSLTN-3),CONTEXT.fillRect(f/5+3,.8*p-3,h*RSLTN,p/5+3)):CONTEXT.fillRect(0,0,f,p);i<WIDTH;){for(a=0,t=LEFT+i,e=OFFSETX+Math.floor(i*l);a<HEIGHT;)(n=Math.ceil(WORLD[t][TOP+a]))?(o!=n&&(CONTEXT.fillStyle=o=MONO?COLORS[1]:COLORS[n%256]),CONTEXT.fillRect(e,OFFSETY+Math.floor(a*s),E,c)):TRACK&&(n=WORLD2[t][TOP+a])&&8==++r&&(r=0,o!=n&&(CONTEXT.fillStyle=o="#bdf"),CONTEXT.fillRect(e,OFFSETY+Math.floor(a*s),d,T)),a++;i++}0==CRITRTYPE&&backtoBin(),drawSmall()}function backtoBin(){let t,e=0;if(!STEP)for(;e<BWIDTH;){for(t=0,WORLD2[e].fill(0);t<BHEIGHT;)WORLD[e][t]=WORLD[e][t]?1:0,t++;e++}}function drawSmall(){let t,e=0;const n=.8*BHEIGHT,a=Math.floor(n*RSLTN),i=RSLTN/5,o=LEFT*i,r=TOP*i,l=PAGEX*i,s=PAGEY*i+a,d=BHEIGHT*i,T=BWIDTH*i,E=ZOOMLEV==ZOOMCT?WIDTH*i-2:WIDTH*i;if(hy=HEIGHT*i-1,wx1=5*E/RSLTN,hy1=5*hy/RSLTN,GUIDE&&0==GUIDECT){for(GUIDECT=GUIDERATE,CONTEXT.fillStyle=EDITMODE?"#006":"#204",CONTEXT.fillRect(1,n*RSLTN-1,T,d),CONTEXT.fillStyle=EDITMODE?"#205":"#402",CONTEXT.fillRect(o+2,a+r,E,hy);e<BWIDTH;){for(t=0;t<BHEIGHT;)WORLD[e][t]&&(e>LEFT&&e<LEFT+wx1&&t>TOP&&t<TOP+hy1?CONTEXT.fillStyle="#ff0":CONTEXT.fillStyle="#888",CONTEXT.fillRect(Math.floor(e/5*RSLTN),Math.floor(a+t/5*RSLTN),1,1)),t++;e++}CONTEXT.strokeStyle=EDITMODE?"#fff":"#8af",CONTEXT.beginPath(),CONTEXT.rect(o+2,a+r,E,hy),CONTEXT.stroke(),CONTEXT.strokeStyle="#fff",CONTEXT.beginPath(),CONTEXT.rect(0,n*RSLTN-2,T+2,d+2),CONTEXT.stroke(),TGUIDE=CONTEXT.getImageData(1,a-4,T+4,d+4)}else GUIDE&&(CONTEXT.strokeStyle=EDITMODE?"#fff":"#8af",CONTEXT.beginPath(),CONTEXT.rect(o+2,a+r,E,hy),CONTEXT.stroke(),CONTEXT.strokeStyle="#fff",CONTEXT.beginPath(),CONTEXT.rect(0,n*RSLTN-2,T+2,d+2),CONTEXT.stroke(),CONTEXT.putImageData(TGUIDE,1,a-4),GUIDECT--);GUIDERATE=Math.min(Math.floor(160/Math.min(FPS,160)),10),GUIDE&&!EDITMODE&&(CONTEXT.fillStyle="#00f",CONTEXT.fillRect(l,s,2,10),CONTEXT.fillRect(l+2,s+2,2,8),CONTEXT.fillRect(l+4,s+4,2,8),CONTEXT.fillStyle="#aaf",CONTEXT.fillRect(l,s,1,3),CONTEXT.fillRect(l+1,s+1,1,2))}function setupCanvas(){canvas.width=BWIDTH*RSLTN,canvas.height=BHEIGHT*RSLTN}function clearWorld(){let t=MAXWIDTH-1;for(;t>=0;)WORLD[t--].fill(0);ifStep(1)}function ifStep(t){(t||!EDITMODE&&0==CRITRTYPE)&&updateWorld(),drawWorld()}function editCursor(){MOUSEY<HEIGHT?editcursor.style.display="block":editcursor.style.display="none"}function randomOpenRectangle(){rectangle(intRand(WIDTH),intRand(HEIGHT),intRand(WIDTH),intRand(HEIGHT),RCLICK?0:1),ifStep(1)}function randomFilledRectangle(){filledRectangle(intRand(WIDTH),intRand(HEIGHT),intRand(WIDTH),intRand(HEIGHT),RCLICK?0:1),ifStep(1)}function randomLine(){line(intRand(WIDTH),intRand(HEIGHT),intRand(WIDTH),intRand(HEIGHT),RCLICK?0:1),ifStep(1)}function line(t,e,n,a,i=1){t+=LEFT,e+=TOP,n+=LEFT,a+=TOP;const o=Math.abs(n-t),r=Math.abs(a-e),l=Math.sign(n-t),s=Math.sign(a-e);let d,T=(o>r?o:-r)/2;for(;t!=n||e!=a;)WORLD[t][e]=i,(d=T)>-o&&(T-=r,t+=l),d<r&&(T+=o,e+=s);WORLD[t][e]=i}function rectangle(t,e,n,a,i=1){line(t,e,n,e,i),line(n,e,n,a,i),line(n,a,t,a,i),line(t,a,t,e,i)}function filledRectangle(t,e,n,a,i=1){let o=t;for(;o!=n;)line(o,e,o,a,i),o+=Math.sign(n-t)}function makeCode(){let t,e,n,a,i=0,r="["+CRITRTYPE+",";if(0==CRITRTYPE)for(r+=LEN1+","+LEN2+","+Math.sign(LIMIT)+",";i<LEN1;){for(e=0;e<LEN2;){for(t=0;t<4;)r+=RULES[i][e][t++]+",";e++}i++}else if(1==CRITRTYPE){for(t=0;t<8;)r+=(VLIFEB[t++]?"1":"0")+",";for(;t<16;)r+=(VLIFED[t++-8]?"1":"0")+","}for(o=RLE0.charAt(Math.floor(BWIDTH/64))+RLE0.charAt(Math.floor(BWIDTH%64)),o+=RLE0.charAt(Math.floor(BHEIGHT/64))+RLE0.charAt(Math.floor(BHEIGHT%64)),o+=WORLD[0][0]?"1":"0",i=0,f=0,n=WORLD[0][0];i<BWIDTH;){for(e=0;e<BHEIGHT;)n==(a=WORLD[i][e]?1:0)?4096==++f&&(o+="!",f=0):(f<26?o+=RLE1.charAt(f):o+=RLE0.charAt(Math.floor(f/64))+RLE0.charAt(f%64),n=a,f=1),e++;i++}copyText(r+"'"+o+"'],\n")}function decodeWorld(t){let e,n,a,i,o,r,l="",s=0,d=0;for(n=64*parseInt(RLE0.indexOf(t.charAt(s++)))+parseInt(RLE0.indexOf(t.charAt(s++))),e=64*parseInt(RLE0.indexOf(t.charAt(s++)))+parseInt(RLE0.indexOf(t.charAt(s++))),i=t.charAt(s++),setRes(1);s<t.length;)"!"==(o=t.charAt(s++))?l+=i.repeat(4096):(l+=(r=parseInt(RLE1.indexOf(o)))>-1?i.repeat(r):i.repeat(64*parseInt(RLE0.indexOf(o))+parseInt(RLE0.indexOf(t.charAt(s++)))),i="1"==i?"0":"1");for(clearWorld(),s=0;d<n;){for(a=0;a<e;)d<MAXWIDTH&&a<MAXHEIGHT?WORLD[d][a]="1"==l.charAt(s++)?1:0:s++,a++;d++}}function copyText(t){if(!navigator.clipboard)return function(t){let e=document.createElement("textarea");e.value=t,e.style.top=e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")?alert(DIDCOPY+t):alert(NOTCOPY+t)}catch(e){alert("ERROR: "+e+NOTCOPY+t)}document.body.removeChild(e)}(t);navigator.clipboard.writeText(t).then(function(){alert(DIDCOPY+t)},function(e){alert("ERROR: "+e+NOTCOPY+t)})}function monoColor(){MONO=!MONO,SHOWN=!1}function playCritrs(){CRITRTYPE=0,SHOWN=!1,matrix.style.display="block"}function playLife(){VLIFEB=[0,0,1,0,0,0,0,0],VLIFED=[1,0,0,1,1,1,1,1],CRITRTYPE=1,SHOWN=!1,matrix.style.display="none"}function updateControls(){const t=LEN1*LEN2,e=Math.floor(15.9-MUTATECT/FPS),n=0==PRESET?PRESETS.length:PRESET,a=PRESET==PRESETS.length-1?PRESETS.length:(PRESET+1)%PRESETS.length,i=LIMIT?7:t*(t-1)/2+1;let o=i**t;e<MT&&(MT=e),o=(o=o.toExponential(2).toString()).substr(0,4)+" &times; 10<sup>"+o.substr(6)+"</sup>",i0.innerHTML=Math.ceil(ZOOMLEV/ZOOMCT*100)+"% ("+WIDTH+" &times; "+HEIGHT+")",i1.innerHTML=DIDPRESET?n+" of "+PRESETS.length:"None (Next is "+a+" of "+PRESETS.length+")",i3.innerHTML=(STEP||EDITMODE?0:FPS)+" FPS",0==CRITRTYPE&&(i2a.innerHTML=MUTATE?"Next Mutation in...":"Not Mutating",i2b.innerHTML=MUTATE?MT+" seconds":"",i4.innerHTML=LEN1+" &times; "+LEN2,i5.innerHTML=t,i6.innerHTML=i.toLocaleString(),i7.innerHTML=i+"<sup>"+t+"</sup> = "+o)}function showRules(){let t,e,n,a,i,o,r,l;if(1==CRITRTYPE)return;const s=Math.floor(LEN1/2),d=Math.floor(LEN2/2);for(i=0,l="<table id=matrix style='border:1px solid #00f;background:#004;opacity:80%'>";i<LEN2;++i,l+="</tr>")for(a=0,l+="<tr>";a<LEN1;++a,l+="</table style='background:#008'></td>")for(l+="<td align=center><table",MUTATED.f&&MUTATED.x==a&&MUTATED.y==i&&(l+=" bgcolor=#22a"),!LIMIT||a!=s&&a!=s-1||i!=d&&i!=d-1||(l+=" bgcolor=#f00"),l+=">",o=0;o<(LIMIT?Math.min(LEN2,2):LEN2);++o,l+="</tr>")for(r=0,l+="<tr>";r<(LIMIT?Math.min(LEN1,2):LEN1);++r,l+="</div></td>")t='<td class="cell" valign=middle',MUTATED.f&&MUTATED.x==a&&MUTATED.y==i&&(MUTATED.p==o&&MUTATED.q==r||MUTATED.r==o&&MUTATED.s==r)&&(t+=' style="background:#08f;color:#ff0"'),e=(t+='><div style="margin-top:-3px; width:18px; margin-left:-2px" onclick="setRule('+a+","+i+","+o+","+r+",")+2+',2)">&FilledSmallSquare;',n=t+0+',2)">&EmptySmallSquare;',RULES[a][i][0]==o&&RULES[a][i][1]==r||RULES[a][i][2]==o&&RULES[a][i][3]==r?l+=e:l+=n;l+="</table>",output1.innerHTML=l}function setRule(t,e,n,a,i,o){RULES[t][e][i]=n,RULES[t][e][i+1]=a,o&&(2==o&&(MUTATED.f=!1),showRules())}function setRules(){let t,e;if(j=0,x=0,1!=CRITRTYPE){for(LENX=Math.floor(LEN1/2),LENY=Math.floor(LEN2/2),LENX1=LIMIT?LENX:0,LENY1=LIMIT?LENY:0;x<LEN1;){for(t=0;t<LEN2;){for(e=0;e<2;)setRule(x,t,LIMIT?intRand(Math.min(LEN2,2)):intRand(LEN2),LIMIT?intRand(Math.min(LEN1,2)):intRand(LEN1),2*e++,0);t++}x++}MUTATED.f=STEPFLAG=DIDPRESET=!1,showRules()}else{for(;j<8;)VLIFEB[j]=intRand(2),VLIFED[j++]=intRand(2);SHOWN=!1}}function writeCritrs(){const t=Math.floor(HEIGHT/5),e=Math.floor(HEIGHT/2),n=Math.floor((e-t)/2),a=4*t,i=Math.floor(WIDTH/1.5/5),o=Math.floor(i/2),r=Math.floor(t+n),l=Math.floor(e+n),s=Math.floor(WIDTH/7),d=s+i,T=d+i,E=T+i,c=E+i,u=c+i;line(s,t,s+o,t),line(s,t,s,a),line(s,a,s+o,a),line(d,e,d+o,e),line(d,e,d,a),line(T,e,T,a),line(E,r,E,a),line(E,e,E+o,e),line(c,e,c+o,e),line(c,e,c,a),line(u,e,u+o,e),line(u,e,u,l),line(u,l,u+o,l),line(u+o,l,u+o,a),line(u,a,u+o,a)}function newPreset(){let t,e,n,a=0,i=0;if(0==(CRITRTYPE=PRESETS[PRESET][a++])){for(LEN1=PRESETS[PRESET][a++],LEN2=PRESETS[PRESET][a++],LIMIT=1==PRESETS[PRESET][a++];i<LEN1;){for(e=0;e<LEN2;){for(n=0;n<4;)RULES[i][e][n++]=PRESETS[PRESET][a++];e++}i++}t=PRESETS[PRESET][a],clearWorld(),""!=t?(decodeWorld(t),drawWorld()):writeCritrs(),MUTATECT=0,DIDPRESET=!0,MT=16,SHOWN=!1,MUTATED.f=!1}else if(1==CRITRTYPE){for(;i<8;)VLIFEB[i++-1]=PRESETS[PRESET][a++];for(;i<16;)VLIFED[i++-9]=PRESETS[PRESET][a++];""!=(t=PRESETS[PRESET][a])?(decodeWorld(t),drawWorld()):writeCritrs()}++PRESET>=PRESETS.length&&(PRESET=0),0==CRITRTYPE&&showRules()}function changeRes(){WIDTH=Math.floor(ZOOMLEV*MODEX),HEIGHT=Math.floor(ZOOMLEV*MODEY),SCALEX=BWIDTH/WIDTH,SCALEY=BHEIGHT/HEIGHT,updateTopLeft()}function updateTopLeft(){const t=BWIDTH-WIDTH,e=BHEIGHT-HEIGHT,n=Math.floor((PAGEX-canvas.offsetLeft)*(t/BWIDTH)),a=Math.floor((PAGEY-canvas.offsetTop)*(e/BHEIGHT));LEFT=n>=t?t:n<0?0:n,TOP=a>=e?e:a<0?0:a}function doMousedown(t){SHIFT&&doEditmode(),1==t.which&&(LCLICK=!0),3==t.which&&(RCLICK=!0),doMousemove(t),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()}function doEditmode(){EDITMODE||document.pointerLockElement!==canvas&&document.mozPointerLockElement!==canvas&&CANV.rpl()}function doZoom(t){const e=t.wheelDelta?t.wheelDelta:-t.deltaY,n=(t.wheelDeltaY?t.wheelDeltaY==-3*t.deltaY:0==t.deltaMode)?1.5:16/RSLTN;clearTimeout(ROTIMEOUT),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),!EDITMODE&&SHIFT&&(PAGEX=t.pageX/RSLTN,PAGEY=t.pageY/RSLTN),1==Math.sign(e)?(ZOOMLEV-=ZOOMLEV/ZOOMCT*n,ZOOMLEV<1&&(ZOOMLEV=1)):(ZOOMLEV+=ZOOMLEV/ZOOMCT*n,ZOOMLEV>ZOOMCT&&(ZOOMLEV=ZOOMCT)),changeRes(),OFFSETX=(t.pageX/RSLTN-canvas.offsetLeft)%SCALEX*RSLTN,OFFSETY=t.pageY/RSLTN%SCALEY*RSLTN,GUIDE&&drawSmall(),ZOOMED=!0,ROTIMEOUT=setTimeout(function(){OFFSETX=OFFSETY=0},150)}function doMousemove(t){!EDITMODE&&t.pageX<BWIDTH*RSLTN&&t.pageY<BHEIGHT*RSLTN&&(PAGEX=t.pageX/RSLTN,PAGEY=t.pageY/RSLTN),EDITMODE?(SHIFT?(PAGEX+=t.movementX,PAGEY+=t.movementY,PAGEX=Math.max(PAGEX,0),PAGEX=Math.min(PAGEX,BWIDTH),PAGEY=Math.max(PAGEY,0),PAGEY=Math.min(PAGEY,BHEIGHT)):(EDITX+=t.movementX,EDITY+=t.movementY),MOUSEX=Math.floor(EDITX/SCALEX),MOUSEY=Math.floor(EDITY/SCALEY),editcursor.style.left=EDITX*RSLTN+"px",editcursor.style.top=EDITY*RSLTN+"px"):(MOUSEX=Math.floor(t.offsetX/RSLTN/SCALEX),MOUSEY=Math.floor(t.offsetY/RSLTN/SCALEY)),ZOOMED=!0,updateTopLeft()}function setHardborder(){HARDB=!HARDB,SHOWN=!1}function setMultipass(){MULTIPASS=!MULTIPASS,SHOWN=!1}function trackChange(){let t=BWIDTH-1;if(TRACK=!TRACK,!TRACK)for(;t>=0;)WORLD2[t--].fill(0);SHOWN=!1}function setGuide(){GUIDE=!GUIDE,SHOWN=!1}function setRes(t){function e(t){let e,n,a;for(j=0;j<BWIDTH;){for(e=0;e<BHEIGHT;){for(n=0,d=0;n<t;){for(a=0;a<t;)d|=WORLD[j+n][e+a++];n++}WORLD[j/t][e/t]=d,e+=t}j+=t}PAGEX/=t,PAGEY/=t}1==RSLTN&&1!=t?e(t):(!function(t){let e,n,a,i;j=BWIDTH*t-t;for(;j>=0;){for(n=BHEIGHT*t-t;n>=0;){for(a=0,e=WORLD[j/t][n/t];a<t;){for(i=0;i<t;)WORLD[j+a][n+i++]=e;a++}n-=t}j-=t}PAGEX*=t,PAGEY*=t}(RSLTN),RSLTN=1,doResize(),e(t)),RSLTN=t,doResize(),FPS=Math.floor(50*(Math.log(RSLTN)+1)),FPSA.fill(FPS)}function setLimit(){LIMIT=!LIMIT,LIMIT?(setRules(),DIDPRESET=!1):showRules(),SHOWN=!1}function setMutate(){DIDPRESET=!1,(MUTATE=!MUTATE)||(MUTATECT=0,MT=MUTATEDELAY+1,MUTATED.f=!1),SHOWN=!1}function setStep(){STEP=!STEP,STEP||(STEPFLAG=!1,MUTATECT=0,MT=MUTATEDELAY+1),SHOWN=!1}function setInfo(){DISPLAY=!DISPLAY,DISPLAY?output1.style.display=output2.style.display="block":output1.style.display=output2.style.display="none"}function lockChanged(){document.pointerLockElement===canvas||document.mozPointerLockElement===canvas?(EDITMODE=!0,EDITX=PAGEX-container.offsetLeft,EDITY=PAGEY-container.offsetTop-canvas.offsetTop,editcursor.style.left=EDITX+"px",editcursor.style.top=EDITY+"px"):(EDITMODE=!1,editcursor.style.display="none"),SHOWN=!1}function doResize(){BWIDTH=Math.floor(Math.min(MAXWIDTH,window.innerWidth-32)/RSLTN),BHEIGHT=Math.floor(Math.min(MAXHEIGHT,window.innerHeight-12)/RSLTN),MODEX=BWIDTH/ZOOMCT,MODEY=BHEIGHT/ZOOMCT,changeRes(),setupCanvas()}function intRand(t){return Math.floor(Math.random()*t)}function createArray(t){let e,n=new Array(t||0),a=t;if(arguments.length>1)for(e=Array.prototype.slice.call(arguments,1);a--;)n[t-1-a]=createArray.apply(this,e);return n}CANV.rpl=canvas.requestPointerLock||canvas.mozRequestPointerLock,init(),canvas.addEventListener("mousedown",doMousedown),canvas.addEventListener("wheel",doZoom),output1.addEventListener("wheel",doZoom),output2.addEventListener("wheel",doZoom),document.body.addEventListener("mousemove",doMousemove),canvas.addEventListener("mouseup",t=>{LCLICK=RCLICK=!1}),window.addEventListener("contextmenu",function(t){t.preventDefault()}),window.addEventListener("keydown",function(t){let e;const n=t.keyCode?t.keyCode:t.which;if(t.shiftKey&&(SHIFT=!0),!EDITMODE){if(0==CRITRTYPE)switch(SHIFT?n+1e3:n){case 69:setMultipass();break;case 73:trackChange();break;case 77:setMutate();break;case 85:setLimit();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:LEN1=n-48,a();break;case 1049:case 1050:case 1051:case 1052:case 1053:case 1054:case 1055:case 1056:case 1057:LEN2=n-48,a()}switch(SHIFT?n+1e3:n){case 65:newPreset();break;case 67:clearWorld();break;case 68:setInfo();break;case 70:randomFilledRectangle();break;case 71:setGuide();break;case 72:setHardborder();break;case 75:makeCode();break;case 76:randomLine();break;case 78:setRules();break;case 79:randomOpenRectangle();break;case 80:setStep();break;case 83:STEPFLAG=!1;break;case 84:monoColor();break;case 87:writeCritrs();break;case 219:(e=RSLTN-1)>0&&(setRes(e),SHOWN=!1);break;case 221:(e=RSLTN+1)<10&&(setRes(e),SHOWN=!1)}}function a(){setRules(),showRules(),DIDPRESET=SHOWN=!1}}),"onpointerlockchange"in document?document.addEventListener("pointerlockchange",lockChanged,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",lockChanged,!1),window.addEventListener("keyup",function(t){SHIFT&&(SHIFT=!1,changeRes(),updateTopLeft(),drawWorld())}),window.addEventListener("resize",doResize);