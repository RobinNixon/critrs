"use strict";const VERSION="0.9b03",DIDCOPY="The following code has been copied to the clipboard. Paste it into the 'presets.js' file to save the current settings as a new preset.\n\n",NOTCOPY=" Could not copy the below to the clipboard, so manually type it into the 'presets.js' file to save the current settings as a new preset.\n\n",MUTATEDELAY=15,FPSBUFSIZE=200,MAXWIDTH=2600,MAXHEIGHT=700;let div=Math.floor,DIDPRESET=!0,GUIDE=!0,DISPLAY=!0,MUTATE=!1,SHOWN=!1,LIMIT=!1,LCLICK=!1,RCLICK=!1,STEP=!1,SHIFT=!1,EDITMODE=!1,MONO=!1,TRACK=!1,HARDB=!1,VARYLIFE=!1,MULTIPASS=!1,STEPFLAG=!1,MOUSEX=0,MOUSEY=0,EDITX=0,EDITY=0,PAGEX=0,PAGEY=0,PRESET=0,MUTATECT=0,OFFSETX=0,OFFSETY=0,TOP=0,ROTIMEOUT=0,GUIDECT=0,LEFT=0,CRITRTYPE=0,GUIDERATE=10,RSLTN=1,CONTROL={},CANVW=Math.min(MAXWIDTH,window.innerWidth-32),CANVH=Math.min(MAXHEIGHT,window.innerHeight-12),BWIDTH=CANVW,BHEIGHT=CANVH,WORLD=createArray(MAXWIDTH,MAXHEIGHT),WORLD2=createArray(MAXWIDTH,MAXHEIGHT),ZOOMCT=100,ZOOMLEV=100,MODEX=BWIDTH/ZOOMCT,MODEY=BHEIGHT/ZOOMCT,WIDTH=BWIDTH,HEIGHT=BHEIGHT,SCALEX=BWIDTH/WIDTH,SCALEY=BHEIGHT/HEIGHT,LEN1=2,LEN2=2,RULES=createArray(9,9,4),OLDFPS=30,FPS=30,FPSA=Array(FPSBUFSIZE).fill(FPS),MUTATED=new Object,MT=MUTATEDELAY+1,TIME=(new Date).getTime(),LENX=div(LEN1/2),LENY=div(LEN2/2),LENX1=LIMIT?LENX:0,LENY1=LIMIT?LENY:0,VLIFEB=[0,0,1,0,0,0,0,0],VLIFED=[1,1,0,0,1,1,1,1],CONTEXT=canvas.getContext("2d",{alpha:!1}),CANV=canvas,TGUIDE="";function init(){CONTROL.s=!1,CONTROL.f=!1,setupCanvas(),clearWorld(),setRes(5),newPreset(),setTimeout(mainLoop,0)}function mainLoop(){let t=0,e=0;const n=(new Date).getTime(),i=1e3/(n-TIME)|0;for(STEPFLAG||EDITMODE||(updateWorld(),STEPFLAG=STEP),drawWorld(),EDITMODE&&editCursor(),(LCLICK||RCLICK)&&function(){CONTROL.s?(CONTROL.f||(LCLICK&&RCLICK?CONTROL.f=3:LCLICK?CONTROL.f=1:RCLICK&&(CONTROL.f=2),CONTROL.x1=MOUSEX+LEFT,CONTROL.y1=MOUSEY+TOP),CONTROL.x2=MOUSEX+LEFT,CONTROL.y2=MOUSEY+TOP):WORLD[MOUSEX+LEFT][MOUSEY+TOP]=LCLICK?1:0;ifStep(0)}(),MUTATE&&function(){let t,e,n,i,a;if(STEPFLAG)return;if(MUTATECT++<(FPS+1)*MUTATEDELAY)return;MUTATECT=0,MT=MUTATEDELAY+1,DIDPRESET=!1;for(;;)if(t=randInt(LEN1),e=randInt(LEN2),n=randInt(LIMIT?Math.min(LEN2,2):LEN2),i=randInt(LIMIT?Math.min(LEN1,2):LEN1),a=2*randInt(2),RULES[t][e][a]!=n||RULES[t][e][a+1]!=i){MUTATED.f=!0,MUTATED.x=t,MUTATED.y=e,MUTATED.p=n,MUTATED.q=i,MUTATED.r=RULES[t][e][2*a],MUTATED.s=RULES[t][e][2*a+1],setRule(t,e,n,i,a,1);break}}(),DISPLAY&&function(){let t,e="";if(SHOWN)return updateControls();if(e+="<table style='border:1px solid #00f; margin:5px; background:#004; opacity:80%'><tr><td><table style='border:none' width=320>",e+="<tr><th colspan=2 style='height:20px; background:#008; color:#8f8;border:1px solid #008; font-size:16px; text-align:center'><b>CRITRS v"+VERSION+" &copy; 2021 by <a href=http://robinnixon.com>Robin Nixon</a></b>&nbsp;</span></th></tr><tr><th colspan=2></th></tr>",e+="<tr><td width=50%>Zoom Level</td><td align=right data-title='If you are not sure how far in or out your are zoomed, ensure the guide window is on and refer to it'><span id=i0>&nbsp;</span></td></tr>",e+="<tr><td>Current Preset</td><td align=right data-title='These presets are in the presets.js file - you can change them or add your own if you download this program'><span id=i1>&nbsp;</span></td></tr>",e+="<tr><td>Frame Rate</td><td align=right data-title='If the frame rate is slow try decreasing resolution, zooming in, or decreasing particles'><span id=i3>&nbsp;</span></td></tr>",1==CRITRTYPE){for(e+="</tr><tr><th colspan=2></th></tr>",e+="<tr><td style='color:#99f'><i>Original Game of Life Rules:</i></td><td align=right style='color:#99f'><i><span style='color:#9f9'>3</span> &nbsp; &amp; &nbsp; <span style='color:#f99'>1, 4, 5, 6, 7, 8&nbsp;</span></i></th></tr>",e+="<tr><td>Create new particle if any of these numbers of neighbors:</td><td align=right><span style='padding-right:3px; color:#9f9'><div class=checknum>1</div><div class=checknum>2</div><div class=checknum>3</div><div class=checknum>4</div><div class=checknum>5</div><div class=checknum>6</div><div class=checknum>7</div><div class=checknum>8</div></span><br>",t=1;t<9;++t)e+="<input type=checkbox "+(VLIFEB[t-1]?"checked ":"")+"onclick='VLIFEB["+(t-1)+"] ^= 1; SHOWN = false'>";for(e+="</span></td></tr>",e+="<tr><td>Remove particle if any of these numbers of neighbors:</td><td align=right><span style='padding-right:3px; color:#f99'><div class=checknum>1</div><div class=checknum>2</div><div class=checknum>3</div><div class=checknum>4</div><div class=checknum>5</div><div class=checknum>6</div><div class=checknum>7</div><div class=checknum>8</div></span><br>",t=1;t<9;++t)e+="<input type=checkbox "+(VLIFED[t-1]?"checked ":"")+"onclick='VLIFED ["+(t-1)+"] ^= 1; SHOWN = false'>";e+="</span></td></tr>",e+="</tr><tr><th colspan=2></th></tr>",e+="<tr><td>Change Resolution &nbsp;<span class=keys><u>&lt;</u> &hellip; <u>&gt;</u></span></td><td data-title='Changing to a lower resolution (to the right) substantially increases the animation frame rate, while higher resolutions (to the left) offer much more detail, at the expense of speed' align=right><input oninput='setRes(parseInt(this.value))' type=range min=1 max=9 value="+RSLTN+"></td></tr>"}e+="</tr><tr><th colspan=2></th></tr>",e+="<tr ><td><u>G</u>uide Window</td><td data-title='Hides &amp; displays the bottom-left window - when the frame rate is slow, hiding the guide can improve animation speed' align=right><label class=switch><input onclick='setGuide()' type=checkbox "+(GUIDE?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>T</u>oggle Color / Monochrome</td><td data-title='Choose between colored or monochrome particles' align=right><label class=switch><input onclick='monoColor()' type=checkbox "+(MONO?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>P</u>ause (then <u>S</u> to Step)</td><td data-title='Select Pause then use the S key to step through animation frame by frame' align=right><label class=switch><input onclick='setStep()' type=checkbox "+(STEP?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><th colspan=2></th></tr>",0==CRITRTYPE?(e+="<tr><td>Allow <u>M</u>utation</td><td data-title='Mutation causes one random change of a rule in a rule set every 15 seconds' align=right><label class=switch><input onclick='setMutate()' type=checkbox "+(MUTATE?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>U</u>se a 2&times;2 Matrix</td><td data-title='Applying rules of larger matrixes to just a 2x2 section increases speed and perceived order' align=right><label class=switch><input onclick='setLimit()' type=checkbox "+(LIMIT?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>H</u>ard Borders</td><td data-title='By default the world is wrap-around, but you can see some very interesting effects with a hard border, such as sand and gravity-like effects - when enabled, try adding more particles using filled rectangles' align=right><label class=switch><input onclick='setHardborder()' type=checkbox "+(HARDB?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td><u>E</u>nable Multiple Passes</td><td data-title='Sometimes strange glitch effects occur when one application of rules clashes with the subsequent rule set application - by using multiple, staggered passes, this effect is diminished' align=right><label class=switch><input onclick='setMultipass()' type=checkbox "+(MULTIPASS?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><td>Track <u>I</u>nvisible Particles</td><td data-title='Some particles move a greater distance than the matrix dimensions each frame, and may not be seen until they collide with another - with this option you can see their trails as a series of small dots - mainly applicable to single passes' align=right><label class=switch><input onclick='trackChange()' type=checkbox "+(TRACK?"checked":"")+"><span class='slider round'></span></label></td></tr>",e+="<tr><th colspan=2></th></tr>",e+="<tr><td>Change Resolution &nbsp;<span class=keys><u>&lt;</u> &hellip; <u>&gt;</u></span></td><td data-title='Changing to a lower resolution (to the right) substantially increases the animation frame rate, while higher resolutions (to the left) offer much more detail, at the expense of speed' align=right><input oninput='setRes(parseInt(this.value))' type=range min=1 max=9 value="+RSLTN+"></td></tr>",e+="<tr><td>Columns: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class=keys><u>1</u> &hellip; <u>9</u></span></td><td align=right data-title='More columns brings more complexity'><input oninput='LEN1=parseInt(this.value); setRules()' type=range min=1 max=9 value="+LEN1+"></td></tr>",e+="<tr><td>Rows: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class=keys><u>Shift</u>-<u>1</u> &hellip; <u>9</u></span></td><td align=right data-title='More rows increases complexity'><input oninput='LEN2=parseInt(this.value); setRules()' type=range min=1 max=9 value="+LEN2+"></td></tr>",e+="<tr><th colspan=2></th></tr>",e+="<tr><td><span id=i2a>Next Mutation</span><td align=right data-title='When mutation is on a random rule change is automaticallyapplied every 15 seconds'><span id=i2b>&nbsp;</span></td></tr>",e+="<tr><td>Matrix Dimensions</td><td align=right data-title='The width and height of the rule matrix'><span id=i4>&nbsp;</span></td></tr>",e+="<tr><td>Number of Cells</td><td align=right data-title='The total number of cells in the rule matrix'><span id=i5>&nbsp;</span></td></tr>",e+="<tr><td>Available Rules per Cell</td><td align=right data-title='The number of different possible combinations of rules per matrix cell'><span id=i6>&nbsp;</span></td></tr>",e+="<tr><td>Possible Combinations</td><td align=right data-title='The grand total number of possible variations of rules for this matrix'><span id=i7>nbsp;<sup>&nbsp;</sup></span></td></tr>",e+="<tr><th colspan=2></th></tr>",e+="<tr><td colspan=2><button onclick='playLife()' style='width:100%'>This is CRITRS - Play The Game of Life</button></td></tr>"):1==CRITRTYPE&&(e+="</tr><tr><th colspan=2></th></tr>",e+="<tr><td colspan=2><button onclick='playCritrs()' style='width:100%'>This is The Game of Life - Play CRITRS</button></td></tr>");e+="<tr><td align=middle><button data-title='Draws a random line of particles in the current view - you can manually draw a line anywhere you want by holding down Ctrl, left-clicking, dragging and releasing the mouse' onclick='randomLine()' style='width:100%'>Random <u>L</u>ine</button></td>",e+=0==CRITRTYPE?"<td align=middle><button data-title='Creates a new random set of rules for this matrix configuration - Tips: Draw with the mouse or add lines &amp; rectangles for interesting results; Click or double click in the rules matrix to change rules' onclick='setRules()' style='width:100%'><u>N</u>ew Random Ruleset</button></td></tr>":"<td align=middle><button data-title='Creates a new random set of rules for the Game of Life - Tips: Draw with the mouse or add lines &amp; rectangles for interesting results - or use the checkboxes above to modify them yourself' onclick='setRules()' style='width:100%'><u>N</u>ew Random Ruleset</button></td></tr>";e+="<tr><td align=middle><button data-title='Draws a random open rectangle of particles in the current view - you can manually draw an open rectangle anywhere you want by holding down Ctrl, right-clicking, dragging and releasing the mouse' onclick='randomOpenRectangle()' style='width:100%'>Random <u>O</u>pen Rect.</button></td><td align=middle><button data-title='Draws a random filled rectangle of particles in the current view - you can manually draw a filled rectangle anywhere you want by holding down Ctrl and both mouse buttons, dragging and releasing the mouse' onclick='randomFilledRectangle()' style='width:100%'>Random <u>F</u>illed Rect.</button></td></tr>",e+="<tr><td align=middle><button data-title='Loads the next ready-made configuration of particles and rules into the current view' onclick='newPreset()' style='width:100%'><u>A</u>pply Next Preset</button></td><td align=middle><button data-title='Removes all particles from the world' onclick='clearWorld()' style='width:100%'><u>C</u>lear All Particles</button></td></tr>",e+="<tr><td align=middle><button data-title='Fills the current view with particles spelling the word Critrs' onclick='writeCritrs()' style='width:100%'><u>W</u>rite 'Critrs'</td><td align=middle><button data-title='Copies the current rule set and particle locations into the keyboard buffer for pasting into the presets.js file - Replace the data string at the end with a pair of quotes to just save the rule set' onclick='makeCode()' style='width:100%'>Copy Preset to <u>K</u>bd.</td></tr>",e+="<tr><td align=middle><button onclick='doEditmode()' data-title='Tips: You can also enter Edit Mode by Shift-Clicking in the window; Hold down Shift while editing to pan &amp zoom; Right click erases; Esc restores previous settings' style='width:100%"+(EDITMODE?";background:#800'><i>Edit Mode - <i>Esc to Exit</i>":";background:#080'><i>Enter Edit Mode")+"</i></td><td align=middle><button data-title='Hides this display &ndash; press D to restore - Tip: Use a mouse scroll wheel or touchpad to zoom in and out, and the mouse to pan' onclick='setInfo()' style='width:100%'>Hide/Restore <u>D</u>isplay</td></tr>",e+="</table></td></tr></table>",output2.innerHTML=e,SHOWN=!0}();t<FPSBUFSIZE-1;)e+=FPSA[t],FPSA[t]=FPSA[1+t++];FPSA[FPSBUFSIZE-1]=STEP||EDITMODE?OLDFPS:i,FPS=div((e+i)/FPSBUFSIZE),OLDFPS=FPS,TIME=n,setTimeout(mainLoop,0)}function updateWorld(){0==CRITRTYPE&&updateCritrs(),1==CRITRTYPE&&updateLife()}function updateLife(){let t,e,n,i,a=0;for(;a<BWIDTH;){for(t=0,WORLD2[a].fill(0);t<BHEIGHT;)n=(WORLD[o(a-1)][s(t-1)]?1:0)+(WORLD[a][s(t-1)]?1:0)+(WORLD[o(a+1)][s(t-1)]?1:0)+(WORLD[o(a-1)][t]?1:0)+(WORLD[o(a+1)][t]?1:0)+(WORLD[o(a-1)][s(t+1)]?1:0)+(WORLD[a][s(t+1)]?1:0)+(WORLD[o(a+1)][s(t+1)]?1:0),(e=WORLD[a][t])&&!VLIFED[n-1]?WORLD2[a][t]=e+.05:!e&&VLIFEB[n-1]&&(WORLD2[a][t]=1),t++;a++}function o(t){return t<0&&(t+=BWIDTH),t>=BWIDTH&&(t-=BWIDTH),t}function s(t){return t<0&&(t+=BHEIGHT),t>=BHEIGHT&&(t-=BHEIGHT),t}i=WORLD,WORLD=WORLD2,WORLD2=i}function updateCritrs(){let t,e,n,i,a,o,s,r,l,d,T,E=0,c=MULTIPASS?LEN1:1,u=MULTIPASS?LEN2:1;do{t=0;do{for(e=E;e<E+(HARDB?BWIDTH-LEN1:BWIDTH+LEN1);){for(n=t;n<t+(HARDB?BHEIGHT-LEN2:BHEIGHT+LEN2);){for(i=0;i<LEN1;){for(a=0;a<LEN2;)WORLD[(e+i)%BWIDTH][(n+a)%BHEIGHT]&&(r=(e+RULES[i][a][1]+LENX1)%BWIDTH,d=(n+RULES[i][a][0]+LENY1)%BHEIGHT,l=(e+RULES[i][a][3]+LENX1)%BWIDTH,T=(n+RULES[i][a][2]+LENY1)%BHEIGHT,(o=WORLD[r][d])&&++o,(s=WORLD[l][T])&&++s,STEPFLAG||o==s||(TRACK&&(WORLD2[r][d]=1),WORLD[r][d]=s,WORLD[l][T]=o)),a++;i++}n+=u}e+=c}++t}while(t<u);++E}while(E<c)}function drawWorld(){let t,e,n,i,a=0,o="",s=0;const r=SCALEX*RSLTN,l=SCALEY*RSLTN,d=FPS<15?Math.ceil(r/4+.5):r/4+.5,T=FPS<15?Math.ceil(l/4+.5):l/4+.5,E=FPS<15?div(r+1):r+1,c=FPS<15?div(l+1):l+1,u=(div(.8*BHEIGHT-r-2),div(BWIDTH/5+l+2),BWIDTH*RSLTN),L=BHEIGHT*RSLTN;for(CONTEXT.fillStyle="#102",CONTEXT.fillRect(0,0,u,L);a<WIDTH;){for(i=0,t=LEFT+a,e=OFFSETX+div(a*r);i<HEIGHT;)(n=Math.ceil(WORLD[t][TOP+i]))?(o!=n&&(CONTEXT.fillStyle=o=MONO?COLORS[1]:COLORS[n%256]),CONTEXT.fillRect(e,OFFSETY+div(i*l),E,c)):TRACK&&(n=WORLD2[t][TOP+i])&&8==++s&&(s=0,o!=n&&(CONTEXT.fillStyle=o="#bdf"),CONTEXT.fillRect(e,OFFSETY+div(i*l),d,T)),i++;a++}CONTROL.f&&(CONTEXT.globalCompositeOperation="lighter",CONTEXT.setLineDash([4,4]),CONTEXT.strokeStyle="#fff",CONTEXT.beginPath(),1==CONTROL.f?(CONTEXT.moveTo(OFFSETX+CONTROL.x1*RSLTN,OFFSETY+CONTROL.y1*RSLTN),CONTEXT.lineTo(OFFSETX+CONTROL.x2*RSLTN,OFFSETY+CONTROL.y2*RSLTN)):CONTEXT.rect(OFFSETX+CONTROL.x1*RSLTN,OFFSETY+CONTROL.y1*RSLTN,OFFSETX+(CONTROL.x2-CONTROL.x1)*RSLTN,OFFSETY+(CONTROL.y2-CONTROL.y1)*RSLTN),CONTEXT.stroke(),CONTEXT.setLineDash([]),CONTEXT.globalCompositeOperation="source-over"),0==CRITRTYPE&&backtoBin(),drawSmall()}function backtoBin(){let t,e=0;if(!STEP)for(;e<BWIDTH;){for(t=0,WORLD2[e].fill(0);t<BHEIGHT;)WORLD[e][t]=WORLD[e][t]?1:0,t++;e++}}function drawSmall(){let t,e=0;const n=.8*BHEIGHT,i=div(n*RSLTN),a=RSLTN/5,o=LEFT*a,s=TOP*a,r=PAGEX*a-canvas.offsetLeft,l=PAGEY*a+i,d=BHEIGHT*a,T=BWIDTH*a,E=ZOOMLEV==ZOOMCT?WIDTH*a-2:WIDTH*a,c=HEIGHT*a-1,u=5*E/RSLTN,L=5*c/RSLTN;if(GUIDE&&0==GUIDECT){for(GUIDECT=GUIDERATE,CONTEXT.fillStyle=EDITMODE?"#006":"#204",CONTEXT.fillRect(1,n*RSLTN-1,T,d),CONTEXT.fillStyle=EDITMODE?"#205":"#402",CONTEXT.fillRect(o+2,i+s,E,c);e<BWIDTH;){for(t=0;t<BHEIGHT;)WORLD[e][t]&&(CONTEXT.fillStyle=e>LEFT&&e<LEFT+u&&t>TOP&&t<TOP+L?"#ff0":"#888",CONTEXT.fillRect(div(e/5*RSLTN),div(i+t/5*RSLTN),1,1)),t++;e++}CONTEXT.strokeStyle=EDITMODE?"#fff":"#8af",CONTEXT.beginPath(),CONTEXT.rect(o+2,i+s,E,c),CONTEXT.stroke(),CONTEXT.strokeStyle="#fff",CONTEXT.beginPath(),CONTEXT.rect(0,n*RSLTN-2,T+2,d+2),CONTEXT.stroke(),TGUIDE=CONTEXT.getImageData(1,i-4,T+4,d+4)}else GUIDE&&(CONTEXT.strokeStyle=EDITMODE?"#fff":"#8af",CONTEXT.beginPath(),CONTEXT.rect(o+2,i+s,E,c),CONTEXT.stroke(),CONTEXT.strokeStyle="#fff",CONTEXT.beginPath(),CONTEXT.rect(0,n*RSLTN-2,T+2,d+2),CONTEXT.stroke(),CONTEXT.putImageData(TGUIDE,1,i-4),GUIDECT--);GUIDERATE=Math.min(div(160/Math.min(FPS,160)),10),GUIDE&&!EDITMODE&&(CONTEXT.fillStyle="#00f",CONTEXT.fillRect(r,l,2,10),CONTEXT.fillRect(r+2,l+2,2,8),CONTEXT.fillRect(r+4,l+4,2,8),CONTEXT.fillStyle="#aaf",CONTEXT.fillRect(r,l,1,3),CONTEXT.fillRect(r+1,l+1,1,2))}function setupCanvas(){canvas.width=BWIDTH*RSLTN,canvas.height=BHEIGHT*RSLTN,canvas.style.border="solid 1px #fff",canvas.style.opacity="100%",CANV.rpl=canvas.requestPointerLock||canvas.mozRequestPointerLock}function clearWorld(){let t=MAXWIDTH-1;for(;t>=0;)WORLD[t--].fill(0);ifStep(1)}function ifStep(t){(t||!EDITMODE&&0==CRITRTYPE)&&updateWorld(),drawWorld()}function editCursor(){editcursor.style.display=MOUSEY<HEIGHT?"block":"none"}function randomOpenRectangle(){rectangle(randInt(WIDTH),randInt(HEIGHT),randInt(WIDTH),randInt(HEIGHT),RCLICK?0:1),ifStep(1)}function randomFilledRectangle(){filledRectangle(randInt(WIDTH),randInt(HEIGHT),randInt(WIDTH),randInt(HEIGHT),RCLICK?0:1),ifStep(1)}function randomLine(){line(randInt(WIDTH),randInt(HEIGHT),randInt(WIDTH),randInt(HEIGHT),RCLICK?0:1),ifStep(1)}function line(t,e,n,i,a=1){t+=LEFT,e+=TOP,n+=LEFT,i+=TOP;const o=Math.abs(n-t),s=Math.abs(i-e),r=Math.sign(n-t),l=Math.sign(i-e);let d,T=(o>s?o:-s)/2;for(;t!=n||e!=i;)WORLD[t][e]=a,(d=T)>-o&&(T-=s,t+=r),d<s&&(T+=o,e+=l);WORLD[t][e]=a}function rectangle(t,e,n,i,a=1){line(t,e,n,e,a),line(n,e,n,i,a),line(n,i,t,i,a),line(t,i,t,e,a)}function filledRectangle(t,e,n,i,a=1){let o=t;for(;o!=n;)line(o,e,o,i,a),o+=Math.sign(n-t)}function makeCode(){let t,e,n,i,a="["+CRITRTYPE+",",o="";if(0==CRITRTYPE)for(a+=LEN1+","+LEN2+","+Math.sign(LIMIT)+",",n=0;n<LEN1;++n)for(i=0;i<LEN2;++i)for(t=0;t<4;++t)a+=RULES[n][i][t]+",";else if(1==CRITRTYPE){for(t=0;t<8;++t)a+=(VLIFEB[t]?"1":"0")+",";for(t=0;t<8;++t)a+=(VLIFED[t]?"1":"0")+","}for(a+=BWIDTH.toString()+","+BHEIGHT.toString()+",'",t=0;t<BWIDTH;++t)for(e=0;e<BHEIGHT;++e)o+=div(WORLD[t][e]).toString().padStart(3,"0");copyText(a+o.compress()+"'],\n")}function decodeWorld(t,e,n){let i,a,o,s,r=0;for(setRes(div(CANVW/e)),SHOWN=!1,a=(i=t.decompress()).length-3,o=0;o<e;++o)for(s=0;s<n;++s,r+=3)WORLD[o][s]=parseInt(i.substring(r,r+3))}function copyText(t){if(!navigator.clipboard)return function(t){let e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")?alert(DIDCOPY+t):alert(NOTCOPY+t)}catch(e){alert("ERROR: "+e+NOTCOPY+t)}document.body.removeChild(e)}(t);navigator.clipboard.writeText(t).then(function(){alert(DIDCOPY+t)},function(e){alert("ERROR: "+e+NOTCOPY+t)})}function monoColor(){MONO=!MONO,SHOWN=!1}function playCritrs(){CRITRTYPE=0,SHOWN=!1,matrix.style.display="block"}function playLife(){VLIFEB=[0,0,1,0,0,0,0,0],VLIFED=[1,0,0,1,1,1,1,1],CRITRTYPE=1,SHOWN=!1,matrix.style.display="none"}function updateControls(){const t=LEN1*LEN2,e=div(15.9-MUTATECT/FPS),n=0==PRESET?PRESETS.length:PRESET,i=PRESET==PRESETS.length-1?PRESETS.length:(PRESET+1)%PRESETS.length,a=LIMIT?7:t*(t-1)/2+1;let o=a**t;e<MT&&(MT=e),o=(o=o.toExponential(2).toString()).substr(0,4)+" &times; 10<sup>"+o.substr(6)+"</sup>",i0.innerHTML=Math.ceil(ZOOMLEV/ZOOMCT*100)+"% ("+WIDTH+" &times; "+HEIGHT+")",i1.innerHTML=DIDPRESET?n+" of "+PRESETS.length:"None (Next is "+i+" of "+PRESETS.length+")",i3.innerHTML=(STEP||EDITMODE?0:FPS)+" FPS",0==CRITRTYPE&&(i2a.innerHTML=MUTATE?"Next Mutation in...":"Not Mutating",i2b.innerHTML=MUTATE?MT+" seconds":"",i4.innerHTML=LEN1+" &times; "+LEN2,i5.innerHTML=t,i6.innerHTML=a.toLocaleString(),i7.innerHTML=a+"<sup>"+t+"</sup> = "+o)}function showRules(){let t,e,n,i,a,o,s,r;if(1==CRITRTYPE)return;const l=div(LEN1/2),d=div(LEN2/2);for(a=0,r="<table id=matrix style='border:1px solid #00f;background:#004;opacity:80%'>";a<LEN2;++a,r+="</tr>")for(i=0,r+="<tr>";i<LEN1;++i,r+="</table style='background:#008'></td>")for(r+="<td align=center><table",MUTATED.f&&MUTATED.x==i&&MUTATED.y==a&&(r+=" bgcolor=#22a"),!LIMIT||i!=l&&i!=l-1||a!=d&&a!=d-1||(r+=" bgcolor=#f00"),r+=">",o=0;o<(LIMIT?Math.min(LEN2,2):LEN2);++o,r+="</tr>")for(s=0,r+="<tr>";s<(LIMIT?Math.min(LEN1,2):LEN1);++s,r+="</div></td>")t='<td class="cell" valign=middle',MUTATED.f&&MUTATED.x==i&&MUTATED.y==a&&(MUTATED.p==o&&MUTATED.q==s||MUTATED.r==o&&MUTATED.s==s)&&(t+=' style="background:#08f;color:#ff0"'),e=(t+='><div style="margin-top:-3px; width:18px; margin-left:-2px" onclick="setRule('+i+","+a+","+o+","+s+",")+2+',2)">&FilledSmallSquare;',n=t+0+',2)">&EmptySmallSquare;',RULES[i][a][0]==o&&RULES[i][a][1]==s||RULES[i][a][2]==o&&RULES[i][a][3]==s?r+=e:r+=n;r+="</table>",output1.innerHTML=r}function setRule(t,e,n,i,a,o){RULES[t][e][a]=n,RULES[t][e][a+1]=i,o&&(2==o&&(MUTATED.f=!1),showRules())}function setRules(){let t,e,n,i;if(1!=CRITRTYPE){for(LENX=div(LEN1/2),LENY=div(LEN2/2),LENX1=LIMIT?LENX:0,LENY1=LIMIT?LENY:0,e=0;e<LEN1;++e)for(n=0;n<LEN2;++n)for(i=0;i<2;++i)setRule(e,n,randInt(LIMIT?Math.min(LEN2,2):LEN2),randInt(LIMIT?Math.min(LEN1,2):LEN1),2*i,0);MUTATED.f=!1,STEPFLAG=!1,DIDPRESET=!1,showRules()}else{for(t=0;t<8;++t)VLIFEB[t]=randInt(2),VLIFED[t]=randInt(2);SHOWN=!1}}function writeCritrs(){const t=div(HEIGHT/5),e=div(HEIGHT/2),n=div((e-t)/2),i=4*t,a=div(WIDTH/1.5/5),o=div(a/2),s=div(t+n),r=div(e+n),l=div(WIDTH/7),d=l+a,T=d+a,E=T+a,c=E+a,u=c+a;line(l,t,l+o,t),line(l,t,l,i),line(l,i,l+o,i),line(d,e,d+o,e),line(d,e,d,i),line(T,e,T,i),line(E,s,E,i),line(E,e,E+o,e),line(c,e,c+o,e),line(c,e,c,i),line(u,e,u+o,e),line(u,e,u,r),line(u,r,u+o,r),line(u+o,r,u+o,i),line(u,i,u+o,i)}function newPreset(){let t,e,n,i,a,o,s=0;if(0==(CRITRTYPE=PRESETS[PRESET][s++])){for(LEN1=PRESETS[PRESET][s++],LEN2=PRESETS[PRESET][s++],LIMIT=1==PRESETS[PRESET][s++],n=0;n<LEN1;++n)for(a=0;a<LEN2;++a)for(o=0;o<4;++o)RULES[n][a][o]=PRESETS[PRESET][s++];showRules()}else if(1==CRITRTYPE){for(n=0;n<8;++n)VLIFEB[n]=PRESETS[PRESET][s++];for(n=0;n<8;++n)VLIFED[n]=PRESETS[PRESET][s++];output1.style.display="none"}i=PRESETS[PRESET][s++],t=PRESETS[PRESET][s++],e=PRESETS[PRESET][s++],clearWorld(),""!=e?decodeWorld(e,i,t):writeCritrs(),MUTATECT=0,DIDPRESET=!0,MT=16,SHOWN=!1,MUTATED.f=!1,++PRESET>=PRESETS.length&&(PRESET=0)}function changeRes(){WIDTH=div(ZOOMLEV*MODEX),HEIGHT=div(ZOOMLEV*MODEY),SCALEX=BWIDTH/(ZOOMLEV*MODEX),SCALEY=BHEIGHT/(ZOOMLEV*MODEY),updateTopLeft()}function updateTopLeft(){let t=BWIDTH-WIDTH,e=BHEIGHT-HEIGHT,n=div((PAGEX-canvas.offsetLeft)*(t/BWIDTH)),i=div((PAGEY-canvas.offsetTop)*(e/BHEIGHT));LEFT=n>=t?t:n<0?0:n,TOP=i>=e?e:i<0?0:i}function doMousedown(t){SHIFT&&doEditmode(),1==t.which&&(LCLICK=!0),3==t.which&&(RCLICK=!0),doMousemove(t),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()}function doEditmode(){EDITMODE||document.pointerLockElement!==canvas&&document.mozPointerLockElement!==canvas&&CANV.rpl()}function doZoom(t){const e=t.wheelDelta?t.wheelDelta:-t.deltaY,n=(t.wheelDeltaY?t.wheelDeltaY==-3*t.deltaY:0==t.deltaMode)?1.5:16/RSLTN;clearTimeout(ROTIMEOUT),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),!EDITMODE&&SHIFT&&(PAGEX=t.pageX/RSLTN,PAGEY=t.pageY/RSLTN),1==Math.sign(e)?(ZOOMLEV-=ZOOMLEV/ZOOMCT*n)<1&&(ZOOMLEV=1):(ZOOMLEV+=ZOOMLEV/ZOOMCT*n)>ZOOMCT&&(ZOOMLEV=ZOOMCT),changeRes(),OFFSETX=(t.pageX/RSLTN-canvas.offsetLeft)%SCALEX*RSLTN,OFFSETY=t.pageY/RSLTN%SCALEY*RSLTN,GUIDE&&drawSmall(),ROTIMEOUT=setTimeout(function(){OFFSETX=0,OFFSETY=0},150)}function doMousemove(t){!EDITMODE&&t.pageX<BWIDTH*RSLTN&&t.pageY<BHEIGHT*RSLTN&&(PAGEX=t.pageX/RSLTN+canvas.offsetLeft-2,PAGEY=t.pageY/RSLTN),EDITMODE?(SHIFT?(PAGEX+=t.movementX,PAGEY+=t.movementY,PAGEX=Math.max(PAGEX,0),PAGEX=Math.min(PAGEX,BWIDTH),PAGEY=Math.max(PAGEY,0),PAGEY=Math.min(PAGEY,BHEIGHT)):(EDITX+=t.movementX,EDITY+=t.movementY),MOUSEX=div(EDITX/SCALEX),MOUSEY=div(EDITY/SCALEY),editcursor.style.left=EDITX*RSLTN+"px",editcursor.style.top=EDITY*RSLTN+"px"):(MOUSEX=div(t.offsetX/RSLTN/SCALEX),MOUSEY=div(t.offsetY/RSLTN/SCALEY)),updateTopLeft()}function setHardborder(){HARDB=!HARDB,SHOWN=!1}function setMultipass(){MULTIPASS=!MULTIPASS,SHOWN=!1}function trackChange(){let t=BWIDTH-1;if(!(TRACK=!TRACK))for(;t>=0;)WORLD2[t--].fill(0);SHOWN=!1}function setGuide(){GUIDE=!GUIDE,SHOWN=!1}function setRes(t){function e(t){let e,n,i,a,o;for(n=0;n<BWIDTH;++n)for(i=0;i<BHEIGHT;++i,WORLD[div(n/t)][div(i/t)]=e)for(a=0,e=0;a<t;++a)for(o=0;o<t;++o)e|=WORLD[n+a][i+o];PAGEX/=t,PAGEY/=t}1==RSLTN&&1!=t?e(t):(!function(t){let e,n,i,a,o;for(n=BWIDTH*t-t;n>=0;n-=t)for(i=BHEIGHT*t-t;i>=0;i-=t)for(a=0,e=WORLD[div(n/t)][div(i/t)];a<t;++a)for(o=0;o<t;++o)WORLD[n+a][i+o]=e;PAGEX*=t,PAGEY*=t}(RSLTN),RSLTN=1,doResize(),e(t)),RSLTN=t,doResize(),FPS=div(50*(Math.log(RSLTN)+1)),FPSA.fill(FPS)}function setLimit(){(LIMIT=!LIMIT)?(setRules(),DIDPRESET=!1):showRules(),SHOWN=!1}function setMutate(){DIDPRESET=!1,(MUTATE=!MUTATE)||(MUTATECT=0,MT=MUTATEDELAY+1,MUTATED.f=!1),SHOWN=!1}function setStep(){(STEP=!STEP)||(STEPFLAG=!1,MUTATECT=0,MT=MUTATEDELAY+1),SHOWN=!1}function setInfo(){(DISPLAY=!DISPLAY)?(output1.style.display="block",output2.style.display="block"):(output1.style.display="none",output2.style.display="none")}function lockChanged(){document.pointerLockElement===canvas||document.mozPointerLockElement===canvas?(EDITMODE=!0,EDITX=6+PAGEX-container.offsetLeft,EDITY=6+PAGEY-container.offsetTop-canvas.offsetTop,editcursor.style.left=EDITX+"px",editcursor.style.top=EDITY+"px"):(EDITMODE=!1,editcursor.style.display="none"),SHOWN=!1}function doResize(){CANVW=Math.min(MAXWIDTH,window.innerWidth-32),CANVH=Math.min(MAXHEIGHT,window.innerHeight-12),BWIDTH=div(CANVW/RSLTN),BHEIGHT=div(CANVH/RSLTN),MODEX=BWIDTH/ZOOMCT,MODEY=BHEIGHT/ZOOMCT,changeRes(),setupCanvas()}function randInt(t){return div(Math.random()*t)}function createArray(t){let e,n=new Array(t||0),i=t;if(arguments.length>1)for(e=Array.prototype.slice.call(arguments,1);i--;)n[t-1-i]=createArray.apply(this,e);return n}document.addEventListener("DOMContentLoaded",init),canvas.addEventListener("mousedown",doMousedown),canvas.addEventListener("wheel",doZoom),output1.addEventListener("wheel",doZoom),output2.addEventListener("wheel",doZoom),document.body.addEventListener("mousemove",doMousemove),canvas.addEventListener("mouseup",t=>{CONTROL.s&&(1==CONTROL.f?line(div(CONTROL.x1/SCALEX),div(CONTROL.y1/SCALEX),div(CONTROL.x2/SCALEY),div(CONTROL.y2/SCALEY)):2==CONTROL.f?rectangle(div(CONTROL.x1/SCALEX),div(CONTROL.y1/SCALEX),div(CONTROL.x2/SCALEY),div(CONTROL.y2/SCALEY)):3==CONTROL.f&&filledRectangle(div(CONTROL.x1/SCALEX),div(CONTROL.y1/SCALEX),div(CONTROL.x2/SCALEY),div(CONTROL.y2/SCALEY)),CONTROL.s=!1,CONTROL.f=!1),LCLICK=RCLICK=!1}),window.addEventListener("contextmenu",function(t){t.preventDefault()}),window.addEventListener("keydown",function(t){const e=t.keyCode?t.keyCode:t.which;if(t.shiftKey&&(SHIFT=!0),t.ctrlKey&&(CONTROL.s=!0),!EDITMODE){if(0==CRITRTYPE)switch(SHIFT?e+1e3:e){case 69:setMultipass();break;case 73:trackChange();break;case 77:setMutate();break;case 85:setLimit();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:LEN1=e-48,n();break;case 1049:case 1050:case 1051:case 1052:case 1053:case 1054:case 1055:case 1056:case 1057:LEN2=e-48,n()}switch(SHIFT?e+1e3:e){case 65:newPreset();break;case 67:clearWorld();break;case 68:setInfo();break;case 70:randomFilledRectangle();break;case 71:setGuide();break;case 72:setHardborder();break;case 75:makeCode();break;case 76:randomLine();break;case 78:setRules();break;case 79:randomOpenRectangle();break;case 80:setStep();break;case 83:STEPFLAG=!1;break;case 84:monoColor();break;case 87:writeCritrs();break;case 188:!function(){let t=RSLTN-1;t>0&&(setRes(t),SHOWN=!1)}();break;case 190:!function(){let t=RSLTN+1;t<10&&(setRes(t),SHOWN=!1)}()}}function n(){setRules(),showRules(),DIDPRESET=!1,SHOWN=!1}}),"onpointerlockchange"in document?document.addEventListener("pointerlockchange",lockChanged,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",lockChanged,!1),window.addEventListener("keyup",function(t){SHIFT&&(SHIFT=!1,changeRes(),updateTopLeft(),drawWorld())}),window.addEventListener("resize",doResize),String.prototype.compress=function(t){t=!0===t;let e,n,i,a={},o=this,s="",r=[],l="",d=256;for(n=0;n<256;++n)a[String.fromCharCode(n)]=n;for(n=0;n<o.length;++n)i=s+(e=o.charAt(n)),a.hasOwnProperty(i)?s=i:(r.push(a[s]),l+=String.fromCharCode(a[s]),a[i]=d++,s=String(e));return""!==s&&(r.push(a[s]),l+=String.fromCharCode(a[s])),t?r:l},String.prototype.decompress=function(){let t,e,n,i,a=[],o=[],s=this,r="",l=256;for(t=0;t<256;t+=1)o[t]=String.fromCharCode(t);if(s&&"string"==typeof s){for(t=0;t<s.length;++t)a.push(s[t].charCodeAt(0));s=a,a=null}for(n=i=String.fromCharCode(s[0]),t=1;t<s.length;++t){if(o[e=s[t]])r=o[e];else{if(e!==l)return null;r=i+i.charAt(0)}n+=r,o[l++]=i+r.charAt(0),i=r}return n};