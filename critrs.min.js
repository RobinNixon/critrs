const VERSION="0.99j",DIDCOPY="The following code has been copied to the clipboard. Paste it into the 'presets.js' file to save the current settings as a new preset.\n\n",NOTCOPY=" Could not copy the below to the clipboard, so manually type it into the 'presets.js' file to save the current settings as a new preset.\n\n",MUTATEDELAY=15,FPSBUFSIZE=100,RLE0="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@#;",RLE1=" :£$%^&*()-_+={}[]~<>,.?/|¬";MAXWIDTH=2200,MAXHEIGHT=640;let DIDPRESET=GUIDE=DISPLAY=!0,MUTATE=SHOWN=LIMIT=LCLICK=RCLICK=STEP=SHIFT=EDITMODE=MONO=TRACK=HARDB=VARYLIFE=MULTIPASS=ZOOMED=STEPFLAG=!1,MOUSEX=MOUSEY=EDITX=EDITY=PAGEX=PAGEY=PRESET=MUTATECT=OFFSETX=OFFSETY=TOP=ROTIMEOUT=LEFT=0,CRITRTYPE=0,QRES=1,SMALLCOUNT=2*QRES,BWIDTH=Math.min(MAXWIDTH,window.innerWidth-32),BHEIGHT=Math.min(MAXHEIGHT,window.innerHeight-12),WORLD=createArray(MAXWIDTH,MAXHEIGHT),WORLD2=createArray(MAXWIDTH,MAXHEIGHT),MODECT=MODE=100,MODEX=BWIDTH/MODECT,MODEY=BHEIGHT/MODECT,WIDTH=BWIDTH,HEIGHT=BHEIGHT,SCALEX=BWIDTH/WIDTH,SCALEY=BHEIGHT/HEIGHT,LEN1=LEN2=2,RULES=createArray(9,9,4),OLDFPS=FPS=30,FPSA=Array(FPSBUFSIZE).fill(FPS),MUTATED=new Object,MT=MUTATEDELAY+1,TIME=(new Date).getTime(),LENX=Math.floor(LEN1/2),LENY=Math.floor(LEN2/2),LENX1=LIMIT?LENX:0,LENY1=LIMIT?LENY:0,VLIFERULES=[3,2,3],SMALLCTR=SMALLCOUNT,CONTEXT=canvas.getContext("2d",{alpha:!1}),CANV=canvas;function init(){setupCanvas(),clearWorld(),setQres(),newPreset(),setTimeout(mainLoop,0)}function mainLoop(){let t=0,e=0;const n=(new Date).getTime(),a=1e3/(n-TIME)|0;for(STEPFLAG||EDITMODE?drawWorld():(updateWorld(),STEPFLAG=STEP,drawWorld()),EDITMODE&&editCursor(),(LCLICK||RCLICK)&&(WORLD[Math.floor(MOUSEX+LEFT)][Math.floor(MOUSEY+TOP)]=LCLICK?1:0,ifStep(0)),MUTATE&&function(){let t,e,n,a,o;if(STEPFLAG)return;if(MUTATECT++<(FPS+1)*MUTATEDELAY)return;MUTATECT=0,MT=MUTATEDELAY+1,DIDPRESET=!1;for(;;)if(t=intRand(LEN1),e=intRand(LEN2),n=LIMIT?intRand(Math.min(LEN2,2)):intRand(LEN2),a=LIMIT?intRand(Math.min(LEN1,2)):intRand(LEN1),o=2*intRand(2),RULES[t][e][o]!=n||RULES[t][e][o+1]!=a){MUTATED.f=!0,MUTATED.x=t,MUTATED.y=e,MUTATED.p=n,MUTATED.q=a,MUTATED.r=RULES[t][e][2*o],MUTATED.s=RULES[t][e][2*o+1],setRule(t,e,n,a,o,1);break}}(),DISPLAY&&function(){let t="";if(SHOWN)return updateControls();t+="<table style='border:1px solid #00f; margin:5px; background:#004; opacity:70%'><tr><td><table style='border:none' width=320>",t+="<tr><th colspan=2 style='height:20px; background:#008; color:#8f8;border:1px solid #008; font-size:16px; text-align:center'><b>CRITRS v"+VERSION+" &nbsp; &copy; 2021 by <a href=http://robinnixon.com>Robin Nixon</a></b>&nbsp;</span></th></tr><tr><th colspan=2></th></tr>",t+="<tr><td width=50%>Zoom Level</td><td align=right><span id=i0>&nbsp;</span></td></tr>",t+="<tr><td>Current Preset</td><td align=right><span id=i1>&nbsp;</span></td></tr>",t+="<tr><td>Frame Rate</td><td align=right><span id=i3>&nbsp;</span></td></tr>",1==CRITRTYPE&&(t+="<tr><td>Life Rules: Neighbors =</td><td align=right><span id=i4>&nbsp;</span></td></tr>");t+="</tr><tr><th colspan=2></th></tr>",t+="<tr ><td><u>G</u>uide Window</td><td data-title='Hides &amp; displays the bottom-left window' align=right><label class=switch><input onclick='setGuide()' type=checkbox "+(GUIDE?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td>High <u>Q</u>uality Res. (<i>slower</i>)</td><td data-title='High resolution gives you four times as much to see, but low resolution is two to three times faster (or more)' align=right><label class=switch><input onclick='setQres()' type=checkbox "+(1==QRES?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td><u>T</u>oggle Color / Monochrome</td><td data-title='Choose between colored or monochrome particles' align=right><label class=switch><input onclick='monoColor()' type=checkbox "+(MONO?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td><u>P</u>ause (then <u>S</u> to Step)</td><td data-title='Select Pause then use the S key to step through animation frame by frame' align=right><label class=switch><input onclick='setStep()' type=checkbox "+(STEP?"checked":"")+"><span class='slider round'></span></label></td></tr>",1==CRITRTYPE&&(t+="<tr><td><u>V</u>ary Rules Randomly</td><td data-title='Varying the rules of Life makes for some interesting results such as fantastic mosaics and spectacular crystalline growths' align=right><label class=switch><input onclick='varyLife()' type=checkbox "+(VARYLIFE?"checked":"")+"><span class='slider round'></span></label></td></tr>");0==CRITRTYPE?(t+="<tr><td>Allow <u>M</u>utation</td><td data-title='Mutation causes one random change of a rule in a rule set every 15 seconds' align=right><label class=switch><input onclick='setMutate()' type=checkbox "+(MUTATE?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td><u>U</u>se a 2&times;2 Matrix</td><td data-title='Applying rules of larger matrixes to just a 2x2 section increases speed and perceived order' align=right><label class=switch><input onclick='setLimit()' type=checkbox "+(LIMIT?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td><u>H</u>ard Borders</td><td data-title='By default the world is wrap-around, but you can see some very interesting effects with a hard border, such as sand and gravity-like effects - when enabled, try adding more particles using filled rectangles' align=right><label class=switch><input onclick='setHardborder()' type=checkbox "+(HARDB?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td><u>E</u>nable Multiple Passes</td><td data-title='Sometimes strange glitch effects occur when one application of rules clashes with the subsequent rule set application - by using multiple, staggered passes, this effect is diminished' align=right><label class=switch><input onclick='setMultipass()' type=checkbox "+(MULTIPASS?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><td>Track <u>I</u>nvisible Particles</td><td data-title='Some particles move a greater distance than the matrix dimensions each frame and may not be seen until they collide with another - with this option you can see their trails as a series of small dots - mainly applicable to single passes' align=right><label class=switch><input onclick='trackChange()' type=checkbox "+(TRACK?"checked":"")+"><span class='slider round'></span></label></td></tr>",t+="<tr><th colspan=2></th></tr>",t+="<tr><td>Columns: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class=keys><u>1</u>&hellip;<u>9</u></span></td><td align=right><input oninput='LEN1=parseInt(this.value); setRules()' type=range min=1 max=9 value="+LEN1+"></td></tr>",t+="<tr><td>Rows: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class=keys><u>Shift</u><u>1</u>&hellip;<u>9</u></span></td><td align=right><input oninput='LEN2=parseInt(this.value); setRules()' type=range min=1 max=9 value="+LEN2+"></td></tr>",t+="<tr><th colspan=2></th></tr>",t+="<tr><td><span id=i2a>Next Mutation</span><td align=right><span id=i2b>&nbsp;</span></td></tr>",t+="<tr><td>Matrix Dimensions</td><td align=right><span id=i4>&nbsp;</span></td></tr>",t+="<tr><td>Number of Cells</td><td align=right><span id=i5>&nbsp;</span></td></tr>",t+="<tr><td>Available Rules per Cell</td><td align=right><span id=i6>&nbsp;</span></td></tr>",t+="<tr><td>Possible Combinations</td><td align=right><span id=i7>&nbsp;<sup>&nbsp;</sup></span></td></tr>",t+="<tr><th colspan=2></th></tr>",t+="<tr><td colspan=2><button onclick='playLife()' style='width:100%'>This is CRITRS - Play The Game of Life</button></td></tr>"):1==CRITRTYPE&&(t+="<tr><td colspan=2><button onclick='playCritrs()' style='width:100%'>This is The Game of Life - Play CRITRS</button></td></tr>");t+="<tr><td align=middle><button data-title='Draws a random line of particles in the current view' onclick='randomLine()' style='width:100%'>Random <u>L</u>ine</button></td>",0==CRITRTYPE||VARYLIFE?t+="<td align=middle><button data-title='Creates a new random set of rules for this matrix configuration - Tips: Draw with the mouse or add lines &amp; rectangles for interesting results; Click or double click in the rules matrix to change rules' onclick='setRules()' style='width:100%'><u>N</u>ew Random Ruleset</button></td></tr>":t+="<td align=middle><button data-title='Draws a random open triangle of particles in the current view' onclick='randomTriangle()' style='width:100%'><u>R</u>andom Open Triangle</button></td></tr>";t+="<tr><td align=middle><button data-title='Draws a random open rectangle of particles in the current view' onclick='randomOpenRectangle()' style='width:100%'>Random <u>O</u>pen Rect.</button></td><td align=middle><button data-title='Draws a random filled rectangle of particles in the current view' onclick='randomFilledRectangle()' style='width:100%'>Random <u>F</u>illed Rect.</button></td></tr>",t+="<tr><td align=middle><button data-title='Loads the next ready-made configuration of particles and rules into the current view' onclick='newPreset()' style='width:100%'><u>A</u>pply Next Preset</button></td><td align=middle><button data-title='Removes all particles from the world' onclick='clearWorld()' style='width:100%'><u>C</u>lear All Particles</button></td></tr>",t+="<tr><td align=middle><button data-title='Fills the current view with particles spelling the word Critrs' onclick='writeCritrs()' style='width:100%'><u>W</u>rite 'Critrs'</td><td align=middle><button data-title='Copies the current rule set and particle locations into the keyboard buffer for pasting into the presets.js file - Replace the data string at the end with a pair of quotes to just save the rule set' onclick='makeCode()' style='width:100%'>Copy Preset to <u>K</u>bd.</td></tr>",t+="<tr><td align=middle><button onclick='doEditmode()' data-title='Tips: You can also enter Edit Mode by Shift-Clicking in the window; Hold down Shift while editing to pan &amp zoom; Right click erases; Esc restores previous settings' style='width:100%"+(EDITMODE?";background:#800'><i>Edit Mode - <i>Esc to Exit</i>":";background:#080'><i>Enter Edit Mode")+"</i></td><td align=middle><button data-title='Hides this display &ndash; press D to restore - Tip: Use a mouse scroll wheel or touchpad to zoom in and out, and the mouse to pan' onclick='setInfo()' style='width:100%'>Hide/Restore <u>D</u>isplay</td></tr>",t+="</table></td></tr></table>",output2.innerHTML=t,SHOWN=!0}();t<FPSBUFSIZE-1;)e+=FPSA[t],FPSA[t]=FPSA[1+t++];STEP||EDITMODE?FPSA[FPSBUFSIZE-1]=OLDFPS:FPSA[FPSBUFSIZE-1]=a,FPS=Math.floor((e+a)/FPSBUFSIZE),OLDFPS=FPS,TIME=n,setTimeout(mainLoop,0)}function updateWorld(){0==CRITRTYPE&&updateCritrs(),1==CRITRTYPE&&updateLife()}function updateLife(){let t,e,n,a,o=0;for(;o<BWIDTH;){for(t=0,WORLD2[o].fill(0);t<BHEIGHT;)n=(WORLD[i(o-1)][r(t-1)]?1:0)+(WORLD[o][r(t-1)]?1:0)+(WORLD[i(o+1)][r(t-1)]?1:0)+(WORLD[i(o-1)][t]?1:0)+(WORLD[i(o+1)][t]?1:0)+(WORLD[i(o-1)][r(t+1)]?1:0)+(WORLD[o][r(t+1)]?1:0)+(WORLD[i(o+1)][r(t+1)]?1:0),(e=WORLD[o][t])&&n>=VLIFERULES[1]&&n<=VLIFERULES[2]?WORLD2[o][t]=e+.1:e||n!=VLIFERULES[0]||(WORLD2[o][t]=1),t++;o++}function i(t){return t<0&&(t+=BWIDTH),t>=BWIDTH&&(t-=BWIDTH),t}function r(t){return t<0&&(t+=BHEIGHT),t>=BHEIGHT&&(t-=BHEIGHT),t}a=WORLD,WORLD=WORLD2,WORLD2=a}function updateCritrs(){let t,e,n,a,o,i,r,l,s,E,T,d=0,c=MULTIPASS?LEN1:1,u=MULTIPASS?LEN2:1;do{t=0;do{for(e=d;e<d+(HARDB?BWIDTH-LEN1:BWIDTH+LEN1);){for(n=t;n<t+(HARDB?BHEIGHT-LEN2:BHEIGHT+LEN2);){for(a=0;a<LEN1;){for(o=0;o<LEN2;)WORLD[(e+a)%BWIDTH][(n+o)%BHEIGHT]&&(l=(e+RULES[a][o][1]+LENX1)%BWIDTH,E=(n+RULES[a][o][0]+LENY1)%BHEIGHT,s=(e+RULES[a][o][3]+LENX1)%BWIDTH,T=(n+RULES[a][o][2]+LENY1)%BHEIGHT,(i=WORLD[l][E])&&++i,(r=WORLD[s][T])&&++r,STEPFLAG||i==r||(TRACK&&(WORLD2[l][E]=1),WORLD[l][E]=r,WORLD[s][T]=i)),o++;a++}n+=u}e+=c}++t}while(t<u);++d}while(d<c)}function drawWorld(){let t,e,n,a,o=0,i="",r=0;const l=SCALEX*QRES,s=SCALEY*QRES,E=FPS<15?Math.ceil(l/4+.5):l/4+.5,T=FPS<15?Math.ceil(s/4+.5):s/4+.5,d=FPS<15?Math.floor(l+1):l+1,c=FPS<15?Math.floor(s+1):s+1,u=.8*BHEIGHT,f=.8*BWIDTH,R=Math.floor(u-l-2)-OFFSETY,L=Math.floor(BWIDTH/5+s+2)-1.8*OFFSETX,h=BWIDTH*QRES,I=BHEIGHT*QRES;for(CONTEXT.fillStyle="#102",GUIDE?(CONTEXT.fillRect(0,0,h,u*QRES-3),CONTEXT.fillRect(h/5+3,.8*I-3,f*QRES,I/5+3)):CONTEXT.fillRect(0,0,h,I);o<WIDTH;){for(a=0,t=LEFT+o,e=OFFSETX+Math.floor(o*l);a<HEIGHT;)(n=Math.ceil(WORLD[t][TOP+a]))?(i!=n&&(CONTEXT.fillStyle=i=MONO?COLORS[1]:COLORS[n%256]),GUIDE&&o*SCALEX<L&&a*SCALEY>R||CONTEXT.fillRect(e,OFFSETY+Math.floor(a*s),d,c)):TRACK&&(n=WORLD2[t][TOP+a])&&8==++r&&(r=0,i!=n&&(CONTEXT.fillStyle=i="#bdf"),GUIDE&&o*SCALEX<L&&a*SCALEY>R||CONTEXT.fillRect(e,OFFSETY+Math.floor(a*s),E,T)),a++;o++}0!=CRITRTYPE||STEP||backtoBin(),drawSmall()}function backtoBin(){let t,e=0;for(;e<BWIDTH;){for(t=0,WORLD2[e].fill(0);t<BHEIGHT;)WORLD[e][t]=WORLD[e][t]?1:0,t++;e++}}function drawSmall(){let t,e=0;const n=.8*BHEIGHT,a=Math.floor(n*QRES),o=QRES/5,i=LEFT*o,r=TOP*o,l=PAGEX*o,s=PAGEY*o+a,E=BHEIGHT*o,T=BWIDTH*o,d=MODE==MODECT?WIDTH*o-2:WIDTH*o;if(hy=HEIGHT*o-1,wx1=5*d/QRES,hy1=5*hy/QRES,!GUIDE&&ZOOMED&&(ZOOMED=!1,CONTEXT.beginPath(),CONTEXT.rect(5*i+6,5*r+3,5*d,5*hy),CONTEXT.stroke()),GUIDE&&0==--SMALLCTR){for(SMALLCTR=SMALLCOUNT,CONTEXT.fillStyle=EDITMODE?"#006":"#204",CONTEXT.fillRect(1,n*QRES-1,T,E),CONTEXT.fillStyle=EDITMODE?"#205":"#402",CONTEXT.fillRect(i+2,a+r,d,hy);e<BWIDTH;){for(t=0;t<BHEIGHT;)WORLD[e][t]&&(e>LEFT&&e<LEFT+wx1&&t>TOP&&t<TOP+hy1?CONTEXT.fillStyle="#ff0":CONTEXT.fillStyle="#888",CONTEXT.fillRect(Math.floor(e/5*QRES),Math.floor(a+t/5*QRES),1,1)),t++;e++}CONTEXT.strokeStyle=EDITMODE?"#fff":"#8af",CONTEXT.beginPath(),CONTEXT.rect(i+2,a+r,d,hy),CONTEXT.stroke(),CONTEXT.strokeStyle="#fff",CONTEXT.beginPath(),CONTEXT.rect(0,n*QRES-2,T+2,E+2),CONTEXT.stroke()}GUIDE&&!EDITMODE&&(CONTEXT.fillStyle="#00f",CONTEXT.fillRect(l,s,2,10),CONTEXT.fillRect(l+2,s+2,2,8),CONTEXT.fillRect(l+4,s+4,2,8),CONTEXT.fillStyle="#aaf",CONTEXT.fillRect(l,s,1,3),CONTEXT.fillRect(l+1,s+1,1,2))}function setupCanvas(){canvas.width=BWIDTH*QRES,canvas.height=BHEIGHT*QRES}function clearWorld(){let t=MAXWIDTH-1;for(;t>=0;)WORLD[t--].fill(0);ifStep(1)}function ifStep(t){(t||!EDITMODE&&0==CRITRTYPE)&&updateWorld(),drawWorld()}function editCursor(){MOUSEY<HEIGHT?editcursor.style.display="block":editcursor.style.display="none"}function randomOpenRectangle(){const t=Math.floor(WIDTH/5),e=Math.floor(WIDTH/10),n=Math.floor(HEIGHT/5),a=Math.floor(HEIGHT/10);rectangle(intRand(WIDTH-t)+e,intRand(HEIGHT-n)+a,intRand(WIDTH-t)+e,intRand(HEIGHT-n)+a,RCLICK?0:1),ifStep(1)}function randomTriangle(){const t=Math.floor(WIDTH/5),e=Math.floor(WIDTH/10),n=Math.floor(HEIGHT/5),a=Math.floor(HEIGHT/10),o=intRand(WIDTH-t)+e,i=intRand(WIDTH-t)+e,r=intRand(WIDTH-t)+e,l=intRand(HEIGHT-n)+a,s=intRand(HEIGHT-n)+a,E=intRand(HEIGHT-n)+a;line(o,l,i,s,RCLICK?0:1),line(i,s,r,E,RCLICK?0:1),line(r,E,o,l,RCLICK?0:1),ifStep(1)}function randomFilledRectangle(){const t=Math.floor(WIDTH/5),e=Math.floor(WIDTH/10),n=Math.floor(HEIGHT/5),a=Math.floor(HEIGHT/10);filledRectangle(intRand(WIDTH-t)+e,intRand(HEIGHT-n)+a,intRand(WIDTH-t)+e,intRand(HEIGHT-n)+a,RCLICK?0:1),ifStep(1)}function randomLine(){const t=Math.floor(WIDTH/5),e=Math.floor(WIDTH/10),n=Math.floor(HEIGHT/5),a=Math.floor(HEIGHT/10);line(intRand(WIDTH-t)+e,intRand(HEIGHT-n)+a,intRand(WIDTH-t)+e,intRand(HEIGHT-n)+a,RCLICK?0:1),ifStep(1)}function line(t,e,n,a,o=1){t+=LEFT,e+=TOP,n+=LEFT,a+=TOP;const i=Math.abs(n-t),r=Math.abs(a-e),l=Math.sign(n-t),s=Math.sign(a-e);let E,T=(i>r?i:-r)/2;for(;t!=n||e!=a;)WORLD[t][e]=o,(E=T)>-i&&(T-=r,t+=l),E<r&&(T+=i,e+=s);WORLD[t][e]=o}function rectangle(t,e,n,a,o=1){line(t,e,n,e,o),line(n,e,n,a,o),line(n,a,t,a,o),line(t,a,t,e,o)}function filledRectangle(t,e,n,a,o=1){let i=t;for(;i!=n;)line(i,e,i,a,o),i+=Math.sign(n-t)}function makeCode(){let t,e,n,a,i=0,r="["+CRITRTYPE+",";if(0==CRITRTYPE)for(r+=LEN1+","+LEN2+","+Math.sign(LIMIT)+",";i<LEN1;){for(e=0;e<LEN2;){for(t=0;t<4;)r+=RULES[i][e][t++]+",";e++}i++}for(o=RLE0.charAt(Math.floor(BWIDTH/64))+RLE0.charAt(Math.floor(BWIDTH%64)),o+=RLE0.charAt(Math.floor(BHEIGHT/64))+RLE0.charAt(Math.floor(BHEIGHT%64)),o+=WORLD[0][0]?"1":"0",i=0,f=0,n=WORLD[0][0];i<BWIDTH;){for(e=0;e<BHEIGHT;)n==(a=WORLD[i][e]?1:0)?4096==++f&&(o+="!",f=0):(f<26?o+=RLE1.charAt(f):o+=RLE0.charAt(Math.floor(f/64))+RLE0.charAt(f%64),n=a,f=1),e++;i++}copyText(r+"'"+o+"'],\n")}function decodeWorld(t){let e,n,a,o,i,r,l="",s=0,E=0;for(n=64*parseInt(RLE0.indexOf(t.charAt(s++)))+parseInt(RLE0.indexOf(t.charAt(s++))),e=64*parseInt(RLE0.indexOf(t.charAt(s++)))+parseInt(RLE0.indexOf(t.charAt(s++))),o=t.charAt(s++),(e>320&&2==QRES||e<=BWIDTH/2&&1==QRES)&&setQres();s<t.length;)"!"==(i=t.charAt(s++))?l+=o.repeat(4096):(l+=(r=parseInt(RLE1.indexOf(i)))>-1?o.repeat(r):o.repeat(64*parseInt(RLE0.indexOf(i))+parseInt(RLE0.indexOf(t.charAt(s++)))),o="1"==o?"0":"1");for(clearWorld(),s=0;E<n;){for(a=0;a<e;)E<MAXWIDTH&&a<MAXHEIGHT?WORLD[E][a]="1"==l.charAt(s++)?1:0:s++,a++;E++}}function copyText(t){if(!navigator.clipboard)return function(t){let e=document.createElement("textarea");e.value=t,e.style.top=e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")?alert(DIDCOPY+t):alert(NOTCOPY+t)}catch(e){alert("ERROR: "+e+NOTCOPY+t)}document.body.removeChild(e)}(t);navigator.clipboard.writeText(t).then(function(){alert(DIDCOPY+t)},function(e){alert("ERROR: "+e+NOTCOPY+t)})}function monoColor(){MONO=!MONO,SHOWN=!1}function playCritrs(){CRITRTYPE=0,SHOWN=VARYLIFE=!1,matrix.style.display="block"}function playLife(){CRITRTYPE=1,SHOWN=!1,matrix.style.display="none"}function varyLife(){VARYLIFE=!VARYLIFE,VARYLIFE?setRules():VLIFERULES=[3,2,3],SHOWN=!1}function updateControls(){const e=LEN1*LEN2,n=Math.floor(15.9-MUTATECT/FPS),a=0==PRESET?PRESETS.length:PRESET,o=PRESET==PRESETS.length-1?PRESETS.length:(PRESET+1)%PRESETS.length,i=LIMIT?7:e*(e-1)/2+1;let r=0,l="";for(t=i**e,n<MT&&(MT=n),t=t.toExponential(2).toString(),t=t.substr(0,4)+" &times; 10<sup>"+t.substr(6)+"</sup>";r<9;)(r<VLIFERULES[1]||r>VLIFERULES[2])&&(l+=r.toString()),r++;i0.innerHTML=Math.ceil(MODE/MODECT*100)+"% ("+WIDTH+" &times; "+HEIGHT+")",i1.innerHTML=DIDPRESET?a+" of "+PRESETS.length:"None (Next is "+o+" of "+PRESETS.length+")",i3.innerHTML=(STEP||EDITMODE?0:FPS)+" FPS",i4.innerHTML="B = "+VLIFERULES[0]+" &nbsp; D = "+l,0==CRITRTYPE&&(i2a.innerHTML=MUTATE?"Next Mutation in...":"Not Mutating",i2b.innerHTML=MUTATE?MT+" seconds":"",i4.innerHTML=LEN1+" &times; "+LEN2,i5.innerHTML=e,i6.innerHTML=i.toLocaleString(),i7.innerHTML=i+"<sup>"+e+"</sup> = "+t)}function showRules(){let t,e,n,a,o,i,r,l;if(VARYLIFE)return;const s=Math.floor(LEN1/2),E=Math.floor(LEN2/2);for(o=0,l="<table id=matrix style='border:1px solid #00f;background:#004;opacity:70%'>";o<LEN2;++o,l+="</tr>")for(a=0,l+="<tr>";a<LEN1;++a,l+="</table style='background:#008'></td>")for(l+="<td align=center><table",MUTATED.f&&MUTATED.x==a&&MUTATED.y==o&&(l+=" bgcolor=#22a"),!LIMIT||a!=s&&a!=s-1||o!=E&&o!=E-1||(l+=" bgcolor=#f00"),l+=">",i=0;i<(LIMIT?Math.min(LEN2,2):LEN2);++i,l+="</tr>")for(r=0,l+="<tr>";r<(LIMIT?Math.min(LEN1,2):LEN1);++r,l+="</div></td>")t='<td class="cell" valign=middle',MUTATED.f&&MUTATED.x==a&&MUTATED.y==o&&(MUTATED.p==i&&MUTATED.q==r||MUTATED.r==i&&MUTATED.s==r)&&(t+=' style="background:#08f;color:#ff0"'),e=(t+='><div style="margin-top:-3px; width:18px; margin-left:-2px" onclick="setRule('+a+","+o+","+i+","+r+",")+2+',2)">&FilledSmallSquare;',n=t+0+',2)">&EmptySmallSquare;',RULES[a][o][0]==i&&RULES[a][o][1]==r||RULES[a][o][2]==i&&RULES[a][o][3]==r?l+=e:l+=n;l+="</table>",output1.innerHTML=l}function setRule(t,e,n,a,o,i){RULES[t][e][o]=n,RULES[t][e][o+1]=a,i&&(2==i&&(MUTATED.f=!1),showRules())}function setRules(){let t,e,n=0;if(VARYLIFE)return VLIFERULES[0]=intRand(3)+1,VLIFERULES[1]=intRand(VLIFERULES[0])+2,void(VLIFERULES[2]=intRand(VLIFERULES[1])+VLIFERULES[1]);for(LENX=Math.floor(LEN1/2),LENY=Math.floor(LEN2/2),LENX1=LIMIT?LENX:0,LENY1=LIMIT?LENY:0;n<LEN1;){for(t=0;t<LEN2;){for(e=0;e<2;)setRule(n,t,LIMIT?intRand(Math.min(LEN2,2)):intRand(LEN2),LIMIT?intRand(Math.min(LEN1,2)):intRand(LEN1),2*e++,0);t++}n++}MUTATED.f=STEPFLAG=DIDPRESET=!1,showRules()}function writeCritrs(){const t=Math.floor(HEIGHT/5),e=Math.floor(HEIGHT/2),n=Math.floor((e-t)/2),a=4*t,o=Math.floor(WIDTH/1.5/5),i=Math.floor(o/2),r=Math.floor(t+n),l=Math.floor(e+n),s=Math.floor(WIDTH/7),E=s+o,T=E+o,d=T+o,c=d+o,u=c+o;line(s,t,s+i,t),line(s,t,s,a),line(s,a,s+i,a),line(E,e,E+i,e),line(E,e,E,a),line(T,e,T,a),line(d,r,d,a),line(d,e,d+i,e),line(c,e,c+i,e),line(c,e,c,a),line(u,e,u+i,e),line(u,e,u,l),line(u,l,u+i,l),line(u+i,l,u+i,a),line(u,a,u+i,a)}function newPreset(){let t,e,n,a=0,o=0;if(0==(CRITRTYPE=PRESETS[PRESET][a++])){for(LEN1=PRESETS[PRESET][a++],LEN2=PRESETS[PRESET][a++],LIMIT=1==PRESETS[PRESET][a++];o<LEN1;){for(e=0;e<LEN2;){for(n=0;n<4;)RULES[o][e][n++]=PRESETS[PRESET][a++];e++}o++}t=PRESETS[PRESET][a],clearWorld(),""!=t?(decodeWorld(t),drawWorld()):writeCritrs(),MUTATECT=0,DIDPRESET=!0,MT=16,SHOWN=!1,MUTATED.f=!1}else 1==CRITRTYPE&&(""!=(t=PRESETS[PRESET][a])?(decodeWorld(t),drawWorld()):writeCritrs());++PRESET>=PRESETS.length&&(PRESET=0),0==CRITRTYPE&&showRules()}function changeMode(){WIDTH=Math.floor(MODE*MODEX),HEIGHT=Math.floor(MODE*MODEY),SCALEX=BWIDTH/WIDTH,SCALEY=BHEIGHT/HEIGHT,updateTopLeft()}function updateTopLeft(){const t=BWIDTH-WIDTH,e=BHEIGHT-HEIGHT,n=Math.floor((PAGEX-canvas.offsetLeft)*(t/BWIDTH)),a=Math.floor((PAGEY-canvas.offsetTop)*(e/BHEIGHT));LEFT=n>=t?t:n<0?0:n,TOP=a>=e?e:a<0?0:a}function doMousedown(t){SHIFT&&doEditmode(),1==t.which&&(LCLICK=!0),3==t.which&&(RCLICK=!0),doMousemove(t),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()}function doEditmode(){EDITMODE||document.pointerLockElement!==canvas&&document.mozPointerLockElement!==canvas&&CANV.rpl()}function doModeChange(t){const e=t.wheelDelta?t.wheelDelta:-t.deltaY,n=(t.wheelDeltaY?t.wheelDeltaY==-3*t.deltaY:0==t.deltaMode)?1.5:16/QRES;clearTimeout(ROTIMEOUT),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),!EDITMODE&&SHIFT&&(PAGEX=t.pageX/QRES,PAGEY=t.pageY/QRES),1==Math.sign(e)?(MODE-=MODE/MODECT*n,MODE<1&&(MODE=1)):(MODE+=MODE/MODECT*n,MODE>MODECT&&(MODE=MODECT)),changeMode(),OFFSETX=(t.pageX/QRES-canvas.offsetLeft)%SCALEX*QRES,OFFSETY=t.pageY/QRES%SCALEY*QRES,GUIDE&&drawSmall(),ZOOMED=!0,ROTIMEOUT=setTimeout(function(){OFFSETX=OFFSETY=0},150)}function doMousemove(t){!EDITMODE&&t.pageX<BWIDTH*QRES&&t.pageY<BHEIGHT*QRES&&(PAGEX=t.pageX/QRES,PAGEY=t.pageY/QRES),EDITMODE?(SHIFT?(PAGEX+=t.movementX,PAGEY+=t.movementY,PAGEX=Math.max(PAGEX,0),PAGEX=Math.min(PAGEX,BWIDTH),PAGEY=Math.max(PAGEY,0),PAGEY=Math.min(PAGEY,BHEIGHT)):(EDITX+=t.movementX,EDITY+=t.movementY),MOUSEX=Math.floor(EDITX/SCALEX),MOUSEY=Math.floor(EDITY/SCALEY),editcursor.style.left=EDITX*QRES+"px",editcursor.style.top=EDITY*QRES+"px"):(MOUSEX=Math.floor(t.offsetX/QRES/SCALEX),MOUSEY=Math.floor(t.offsetY/QRES/SCALEY)),ZOOMED=!0,updateTopLeft()}function setHardborder(){HARDB=!HARDB,SHOWN=!1}function setMultipass(){MULTIPASS=!MULTIPASS,SHOWN=!1}function trackChange(){let t=BWIDTH-1;if(TRACK=!TRACK,!TRACK)for(;t>=0;)WORLD2[t--].fill(0);SHOWN=!1}function setGuide(){GUIDE=!GUIDE,SHOWN=!1}function setQres(){let t,e,n,a,o,i=0;if(2==(QRES=1==QRES?2:1)){for(;i<BWIDTH;){for(n=0;n<BHEIGHT;){for(a=0,e=0;a<2;){for(o=0;o<2;)e+=WORLD[i+a][n+o++];a++}WORLD[i/2][n/2]=Math.sign(e),n+=2}i+=2}PAGEX/=2,PAGEY/=2,FPS*=2}else{for(i=2*BWIDTH-2;i>=0;){for(n=2*BHEIGHT-2;n>=0;){for(a=0,t=WORLD[i/2][n/2];a<2;){for(o=0;o<2;)WORLD[i+a][n+o++]=t;a++}n-=2}i-=2}PAGEX*=2,PAGEY*=2,FPS/=2}FPSA.fill(FPS),doResize(),SHOWN=!1}function setLimit(){LIMIT=!LIMIT,LIMIT?(setRules(),DIDPRESET=!1):showRules(),SHOWN=!1}function setMutate(){DIDPRESET=!1,(MUTATE=!MUTATE)||(MUTATECT=0,MT=MUTATEDELAY+1,MUTATED.f=!1),SHOWN=!1}function setStep(){STEP=!STEP,STEP?SMALLCOUNT=1:(STEPFLAG=!1,SMALLCOUNT=2*QRES,MUTATECT=0,MT=MUTATEDELAY+1),SHOWN=!1}function setInfo(){DISPLAY=!DISPLAY,DISPLAY?output1.style.display=output2.style.display="block":output1.style.display=output2.style.display="none"}function lockChanged(){document.pointerLockElement===canvas||document.mozPointerLockElement===canvas?(EDITMODE=!0,EDITX=PAGEX-container.offsetLeft,EDITY=PAGEY-container.offsetTop-canvas.offsetTop,editcursor.style.left=EDITX+"px",editcursor.style.top=EDITY+"px"):(EDITMODE=!1,editcursor.style.display="none"),SHOWN=!1}function doResize(){BWIDTH=Math.floor(Math.min(MAXWIDTH,window.innerWidth-32)/QRES),BHEIGHT=Math.floor(Math.min(MAXHEIGHT,window.innerHeight-12)/QRES),MODEX=BWIDTH/MODECT,MODEY=BHEIGHT/MODECT,changeMode(),setupCanvas()}function intRand(t){return Math.floor(Math.random()*t)}function createArray(t){let e,n=new Array(t||0),a=t;if(arguments.length>1)for(e=Array.prototype.slice.call(arguments,1);a--;)n[t-1-a]=createArray.apply(this,e);return n}CANV.rpl=canvas.requestPointerLock||canvas.mozRequestPointerLock,init(),canvas.addEventListener("mousedown",doMousedown),canvas.addEventListener("wheel",doModeChange),output1.addEventListener("wheel",doModeChange),output2.addEventListener("wheel",doModeChange),document.body.addEventListener("mousemove",doMousemove),canvas.addEventListener("mouseup",t=>{LCLICK=RCLICK=!1}),window.addEventListener("contextmenu",function(t){t.preventDefault()}),window.addEventListener("keydown",function(t){const e=t.keyCode?t.keyCode:t.which;if(t.shiftKey&&(SHIFT=!0),!EDITMODE){if(0==CRITRTYPE||VARYLIFE)switch(SHIFT?e+1e3:e){case 72:setHardborder();break;case 73:trackChange();break;case 77:setMutate();break;case 78:setRules();break;case 85:setLimit();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:LEN1=e-48,n();break;case 1049:case 1050:case 1051:case 1052:case 1053:case 1054:case 1055:case 1056:case 1057:LEN2=e-48,n()}switch(SHIFT?e+1e3:e){case 65:newPreset();break;case 67:clearWorld();break;case 68:setInfo();break;case 69:setMultipass();break;case 70:randomFilledRectangle();break;case 71:setGuide();break;case 75:makeCode();break;case 76:randomLine();break;case 79:randomOpenRectangle();break;case 80:setStep();break;case 81:setQres();break;case 82:randomTriangle();break;case 83:STEPFLAG=!1,backtoBin();break;case 84:monoColor();break;case 86:varyLife();break;case 87:writeCritrs()}}function n(){setRules(),showRules(),DIDPRESET=SHOWN=!1}}),"onpointerlockchange"in document?document.addEventListener("pointerlockchange",lockChanged,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",lockChanged,!1),window.addEventListener("keyup",function(t){SHIFT&&(SHIFT=!1,changeMode(),updateTopLeft(),drawWorld())}),window.addEventListener("resize",doResize);